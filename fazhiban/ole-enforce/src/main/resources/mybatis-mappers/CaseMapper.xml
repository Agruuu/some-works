<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.orhonit.ole.enforce.dao.CaseDao">

   <!-- 根据案件id查询案件的文书 -->
	<select id="findCaseDoc" resultType="com.orhonit.ole.enforce.dto.CaseDocDTO">
		SELECT 
			edc.id as docContentId,
			ec.id as caseId,
			edt.name AS templateName ,
			edt.id AS templateId,
			edt.code AS templateCode,
			caseStatusDict.enum_desc  caseStatus,
			ec.case_num AS caseNum
		FROM ole_ef_doc_content edc   
			LEFT JOIN ole_ef_doc_template edt ON edt.id = edc.template_id 
			LEFT JOIN ole_ef_case ec   ON edc.case_id = ec.id
			LEFT JOIN ole_sys_dict caseStatusDict ON caseStatusDict.enum_value = edc.flow_status AND caseStatusDict.type_value in  ('1500')
		WHERE  ec.id = #{caseId}   order by  edc.create_date desc; 
	</select>


 	<!-- 根据部门ID查询当前及下属部门的所有执法人员  （只查询执法机构）-->
	<select id="getDeptUserByCurrentUser" resultType="com.orhonit.ole.enforce.dto.DeptPersonDTO">
	
	SELECT
		bdp.id AS personId,
		bdp.name AS personName,
		bdp.cert_num AS certNum,
		obd.name AS deptName,
		obd.id AS deptId
	FROM ole_sys_user su 
	
		LEFT JOIN ole_base_dept_person AS bdp ON bdp.ID = su.person_id
		LEFT JOIN ole_base_dept obd ON obd.id = bdp.dept_id
	WHERE <!-- FIND_IN_SET(bdp.dept_id,getBaseDeptByParentId(#{deptId}))  -->
		su.dept_id = #{deptId}
	AND su.status = 1 AND su.id IN ( SELECT userid FROM ole_sys_role_user sru WHERE sru.roleId = #{roleId});
	</select>
	
	<!-- 案件列表查询-->
	<select id="caseList" resultType="com.orhonit.ole.enforce.dto.CaseListDTO">
		SELECT  ec.id as id,
			ec.case_name AS caseName, 
			ec.case_num AS caseNum, 
			sd.enum_desc AS caseSource,
			bd.name AS deptName,
			ec.case_address caseAddress,
			ec.case_zzfryname As casezzfryName,
			ec.case_time AS caseTime,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpDate,
			ec.case_handler AS caseHandler,
			ec.case_zzfryname AS zzfryName,
			ec.case_zpr AS zprId,
			sd1.enum_desc AS caseStatus
			FROM ole_ef_case ec 
			LEFT JOIN act_ru_execution re on re.BUSINESS_KEY_=ec.case_num
			LEFT JOIN ACT_RU_TASK RES ON re.ID_ = RES.PROC_INST_ID_	 
			LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ec.case_status AND sd1.type_value = '1500' 
			LEFT JOIN ole_sys_dict sd ON sd.enum_value = ec.case_source AND sd.type_value = #{params.typeValue}
			LEFT JOIN ole_base_dept bd ON bd.id = ec.dept_id
	<where>
		<!-- ec.case_zpr IN (SELECT id FROM ole_sys_user WHERE FIND_IN_SET 
		(dept_id,getBaseDeptByParentId((SELECT dept_id FROM ole_sys_user WHERE username = #{params.userId})))) -->
			<if test="params.id != null and params.id != ''">
				and ec.case_num like concat('%', #{params.id}, '%')
			</if>
			<if test="params.caseName != null and params.caseName != ''">
				and ec.case_name like concat('%', #{params.caseName}, '%')
			</if>
			<if test="params.zzfryName != null and params.zzfryName != ''">
				and ec.case_zzfryname like concat('%', #{params.zzfryName}, '%')
			</if>
			<if test="params.caseTime != null and params.caseTime != ''">
				and DATEDIFF(DATE_FORMAT(ec.case_time,'%Y-%m-%d'),#{params.caseTime})=0
			</if>
			<if test="params.caseStatus != null">
				and ec.case_status = #{params.caseStatus} 
			</if>
			<if test="params.zzfryId != null">
				and ec.case_zzfryid = #{params.zzfryId} 
			</if>
			<if test="params.personId != null">
				and (ec.case_zzfryid = #{params.personId}   or  ec.case_fzfryid  like  concat('%', #{params.personId}, '%')  or  RES.ASSIGNEE_=#{params.dealUserId} 
				<if test="params.caseZpr != null">
				     or ec.case_zpr = #{params.caseZpr} 
				</if>
				)
			</if> 
			<if test="params.areaId != null">
				and ec.dept_id IN (SELECT id FROM ole_base_dept WHERE area_id =#{params.areaId}) 
			</if>
			<!-- <if test="params.caseZpr != null">
				and ec.case_zpr = #{params.caseZpr} 
			</if> -->
			<if test="params.myCase != null and params.myCase != ''">
				and (ec.case_zzfryname = #{params.myCase} or ec.case_fzfryname like concat('%', #{params.myCase}, '%') )
			</if>
		</where>
		order by ec.create_date desc
		<if test="params.start != null and params.length !=null">
			limit #{params.start}, #{params.length};
		</if>
        
        
	</select>
	
	<sql id="where">
	</sql>
	
	<!-- 案件列表查询总数-->
	<select id="count" resultType="int">
	SELECT  count(ec.id) FROM ole_ef_case ec 
	LEFT JOIN ole_sys_dict sd ON sd.enum_value = ec.case_source AND sd.type_value = #{params.typeValue}
	LEFT JOIN act_ru_execution re on re.BUSINESS_KEY_=ec.case_num
	LEFT JOIN ACT_RU_TASK RES ON re.ID_ = RES.PROC_INST_ID_	 
			<where>
				<!-- ec.case_zpr IN (SELECT id FROM ole_sys_user WHERE FIND_IN_SET (dept_id,getBaseDeptByParentId((SELECT dept_id FROM ole_sys_user WHERE username = #{params.userId})))) -->
		
			<if test="params.id != null and params.id != ''">
				and ec.case_num like concat('%', #{params.id}, '%')
			</if>
			<if test="params.caseName != null and params.caseName != ''">
				and ec.case_name like concat('%', #{params.caseName}, '%')
			</if>
			<if test="params.zzfryName != null and params.zzfryName != ''">
				and ec.case_zzfryname like concat('%', #{params.zzfryName}, '%')
			</if>
			<if test="params.caseTime != null and params.caseTime != ''">
				and DATEDIFF(DATE_FORMAT(ec.case_time,'%Y-%m-%d'),#{params.caseTime})=0
			</if>
			<if test="params.caseStatus != null">
				and ec.case_status = #{params.caseStatus} 
			</if>
			<if test="params.zzfryId != null">
				and ec.case_zzfryid = #{params.zzfryId} 
			</if>
			<if test="params.personId != null">
				and (ec.case_zzfryid = #{params.personId}   or  ec.case_fzfryid  like  concat('%', #{params.personId}, '%')  or  RES.ASSIGNEE_=#{params.dealUserId} 
				<if test="params.caseZpr != null">
				     or ec.case_zpr = #{params.caseZpr} 
				</if>
				)
			</if> 
			<if test="params.areaId != null">
				and ec.dept_id IN (SELECT id FROM ole_base_dept WHERE area_id =#{params.areaId}) 
			</if>
			<!-- <if test="params.caseZpr != null">
				and ec.case_zpr = #{params.caseZpr} 
			</if> -->
			<if test="params.myCase != null and params.myCase != ''">
				and (ec.case_zzfryname = #{params.myCase} or ec.case_fzfryname like concat('%', #{params.myCase}, '%'))
			</if>
		</where>
		;	
	</select>
	
	<!-- 根据personId统计案件  or ec.case_fzfryid = #{params.personId}-->
	<select id="caseCount" resultType="int">
		SELECT  count(*) FROM ole_ef_case ec 
		<where>
			1=1
			<if test="params.personId != null and params.personId != ''">
				and ec.case_zzfryid = #{params.personId}
			</if>
		</where>
		;	
	</select>
	
	<select id="needDealCount" resultType="com.orhonit.ole.enforce.dto.api.ApiCountDTO">
		SELECT
			count(*) as count
		FROM
			ACT_RU_TASK
		WHERE
			ASSIGNEE_ = #{id}
		AND PROC_DEF_ID_ LIKE 'case%'
	</select>
	
	<select id="caseSubmitCount" resultType="com.orhonit.ole.enforce.dto.api.ApiCountDTO">
		SELECT
			count(*) as count
		FROM
			ole_ef_case
		WHERE
			exe_type='1'
		AND case_zzfryid = #{id}
	</select>
	
	<select id="caseSubmitCountByDeptid" resultType="com.orhonit.ole.enforce.dto.api.ApiCountDTO">
		SELECT
			count(*) as count
		FROM
			ole_ef_case ec
		LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id 
		LEFT JOIN ole_base_area ba on bd.area_id = ba.id 
		WHERE
			exe_type='1'
		<!--AND case_zzfryid = #{id}-->
		<if test="params.deptId != null and params.deptId != ''">
				and FIND_IN_SET (bd.id , #{params.deptId})
		</if>
		<if test="params.areaId != null and params.areaId != ''">
			and ba.id = #{params.areaId}
		</if>
	</select>
	
	<select id="caseCountByStatus" resultType="com.orhonit.ole.enforce.dto.api.ApiCountDTO">
		SELECT
			sd.enum_desc as statusName,
			count(ec.id) as count
		FROM ole_ef_case ec
		LEFT JOIN ole_sys_dict sd on ec.case_status = sd.enum_value and sd.type_value = '1500'
		<where>
			1=1
			<if test="params.status != null and params.status != ''">
				AND ec.case_status = #{params.status}
			</if>
			<if test="params.deptId != null and params.deptId != ''">
				AND ec.dept_id = #{params.deptId}
			</if>
			<if test="params.coordinator != null and params.coordinator != ''">
				AND ec.case_zzfryid = #{params.coordinator}
			</if>
			<if test="params.personId != null and params.personId != ''">
				AND (ec.case_zzfryid = #{params.personId} 
				or ec.case_fzfryid like concat('%', #{params.personId}, '%'))
			</if>
		</where>
					
	</select>

	<!--根据案件ID查询案件基本信息和当事人信息-->
	<select id="findCaseDetail" resultType="com.orhonit.ole.enforce.dto.CaseDetailDTO">
		SELECT 
			ec.id AS caseId, 
			ec.case_num AS caseNum,
			ec.case_name AS caseName,
			SD.ENUM_DESC caseSource,
			ec.case_apply_date as caseApplyDate,
			ec.case_address as caseAddress,
			ec.brief_case_content as briefCaseContent,
			ec.case_handler  as caseHandler,
			epi.type  as type,
			epi.name  as name,
			epi.age   as age,
			epi.sex   as sex,
			epi.tel   as tel,
			epi.id_card  as idCard,
			epi.post_code as postCode,
			epi.address as address,
			epi.unit_name as unitName,
			epi.unit_address as unitAddress,
			epi.legal_name as legalName,
			epi.org_id_card as orgIdCard,
			epi.org_code as orgCode
		FROM ole_ef_case ec   
		     LEFT JOIN ole_ef_party_info epi ON ec.id = epi.case_id
		     LEFT JOIN OLE_SYS_DICT SD ON ec.CASE_SOURCE = SD.ENUM_VALUE AND SD.TYPE_VALUE = #{params.typeCaseSource}
		WHERE ec.id = #{params.caseId};
	</select>
	
	<!-- 获取案件详情 -->
	<select id="getCaseDetailInfo" resultType="com.orhonit.ole.enforce.dto.CaseDetailInfoDTO">
		SELECT 
			EF.ID caseId ,
			EF.CASE_NAME caseName, 
			SD.ENUM_DESC caseSource, 
			EF.case_address caseAddress,
			ef.case_apply_date caseApplyDate,
			EF.case_reason caseReason,
			ef.brief_case_content briefCaseContent, 
			ef.case_handler caseHandler, 
			SU.NICKNAME caseZpr,
			EF.CASE_ZPDATE caseZpdate, 
			ef.case_zzfryname caseZzfryname,
			ef.case_zzfryid caseZzfryid, 
			ef.case_fzfryname caseFzfryname,
			SDCS.enum_desc AS caseStatus, 
			ef.case_num caseNum, 
			ef.update_date caseUpdateDate, 
			SDCT.enum_desc caseType,
			GROUP_CONCAT(bplm.fz_content) AS fzContent,
			ef.case_time caseTime, 
			SDPT.enum_desc AS type ,
			epi.name  AS name,
			epi.age AS age,
			SDPX.enum_desc AS sex,
			epi.tel AS tel,
			epi.id_card  AS idCard,
			epi.post_code AS postCode,
			epi.address AS address,
			epi.unit_name AS unitName,
			epi.unit_address AS unitAddress,
			epi.legal_name AS legalName,
			epi.org_id_card AS orgIdCard,
			epi.org_code AS orgCode, 
			EF.CHECK_ID AS checkId,
			PT.enum_desc AS punishTypeName,
			EF.punish_type AS punishType,
			EF.punish_cash AS punishCash,
			EF.punish_bill   AS punishBill
		FROM OLE_EF_CASE EF 
			LEFT JOIN OLE_SYS_DICT SD ON EF.CASE_SOURCE = SD.ENUM_VALUE AND SD.TYPE_VALUE = #{params.typeCaseSource}
			LEFT JOIN OLE_SYS_DICT SDCS ON EF.CASE_STATUS = SDCS.ENUM_VALUE AND SDCS.TYPE_VALUE = #{params.typeCaseStatus}
			LEFT JOIN OLE_SYS_DICT SDCT ON EF.CASE_TYPE = SDCT.ENUM_VALUE AND SDCT.TYPE_VALUE = #{params.typeCaseType}
			LEFT JOIN OLE_SYS_DICT PT ON EF.punish_type = PT.ENUM_VALUE AND PT.TYPE_VALUE = #{params.punishType}
			LEFT JOIN OLE_SYS_USER SU ON EF.CASE_ZPR = SU.ID 
			LEFT JOIN ole_ef_party_info epi ON ef.id = epi.case_id
			LEFT JOIN ole_base_potence_law_map bplm ON FIND_IN_SET(bplm.right_duty_id,EF.potence_id) AND FIND_IN_SET(bplm.id,EF.potence_law_map_id)
			LEFT JOIN OLE_SYS_DICT SDPX ON epi.sex = SDPX.ENUM_VALUE AND SDPX.TYPE_VALUE = #{params.typePartySex}
			LEFT JOIN OLE_SYS_DICT SDPT ON epi.type = SDPT.ENUM_VALUE AND SDPT.TYPE_VALUE = #{params.typePartyType}
			WHERE EF.ID = #{caseId};
	</select>
	
	<!--PS 案件列表查询总数 -->
	<select id="getMessageNum" resultType="INTEGER" parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
      SELECT count(ec.id)
      	FROM ole_ef_case ec
      	LEFT JOIN
			ole_base_dept bd on bd.id = ec.dept_id 
		LEFT JOIN ole_base_area ba on bd.area_id = ba.id
		<where>
			 bd.is_ps='1'
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
		</where>
    </select>
    
    <!--PS 一般案件列表查询总数 -->
	<select id="getGeneralNum" resultType="INTEGER" parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
      SELECT count(ec.id)
      	FROM ole_ef_case ec
      	LEFT JOIN
			ole_base_dept bd on bd.id = ec.dept_id 
		LEFT JOIN ole_base_area ba on bd.area_id = ba.id
		LEFT JOIN ole_sys_dict sd on ec.case_status=sd.enum_value and sd.type_value="1500"
		LEFT JOIN ole_sys_dict sd1 on ec.case_source=sd1.enum_value and sd1.type_value="1002"
		LEFT JOIN ole_sys_dict sd2 on ec.flow_type=sd2.enum_value and sd2.type_value="1802"
		<where>
			ec.flow_type=2
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
		</where>
    </select>
    
       <!--PS 重大案件列表查询总数 -->
	<select id="getSeriousNum" resultType="INTEGER" parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
      SELECT count(ec.id)
      	FROM ole_ef_case ec
      	LEFT JOIN
			ole_base_dept bd on bd.id = ec.dept_id 
		LEFT JOIN ole_base_area ba on bd.area_id = ba.id
		<where>
			ec.flow_type=3
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
		</where>
    </select>
    
    <!--PS 已结案案件列表查询总数 -->
	<select id="getCasecaseNum" resultType="INTEGER" parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
      SELECT count(ec.id)
      	FROM ole_ef_case ec
      	LEFT JOIN
			ole_base_dept bd on bd.id = ec.dept_id 
		LEFT JOIN ole_base_area ba on bd.area_id = ba.id
		<where>
			ec.case_status='90'
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
			<if test="isReview != null and isReview != ''  and  isReview==1 ">
				and ec.id  in (SELECT case_id FROM ole_ef_review_record)
			</if>
			<if test="isReview != null and isReview != ''  and  isReview==0 ">
				and ec.id  not   in (SELECT case_id FROM ole_ef_review_record)
			</if>
		</where>
    </select>
    
     <!--PS 简易案件列表查询总数 -->
	<select id="getSimpleNum" resultType="INTEGER" parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
      SELECT count(ec.id)
      	FROM ole_ef_case ec
      	LEFT JOIN
			ole_base_dept bd on bd.id = ec.dept_id 
		LEFT JOIN ole_base_area ba on bd.area_id = ba.id
		<where>
			ec.flow_type=1
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
		</where>
    </select>
    
    <!--PS 简易案件列表查询总数 -->
	<select id="selectGeneralSimpleNum" resultType="INTEGER" parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
      SELECT count(ec.id)
      	FROM ole_ef_case ec
      	LEFT JOIN
			ole_base_dept bd on bd.id = ec.dept_id 
		LEFT JOIN ole_base_area ba on bd.area_id = ba.id
		<where>
			ec.flow_type=1 and ec.flow_type=2
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
		</where>
    </select>
    
    <!--PS 简易案件列表查询总数 -->
	<select id="caseAllListNum" resultType="INTEGER" parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO"><!--  parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO" -->
      SELECT count(ec.id)
      	FROM ole_ef_case ec
      	LEFT JOIN
			ole_base_dept bd on bd.id = ec.dept_id 
		LEFT JOIN ole_base_area ba on bd.area_id = ba.id
		<where>
			1=1
			<!-- YEAR(ec.create_date)=YEAR(NOW()) -->
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
		</where>
    </select>
    
    <!--PS 简易案件列表查询总数 -->
	<select id="caseAllListNumMap" resultType="INTEGER">
		SELECT
		 	COUNT(ec.id)
		 	FROM ole_ef_case ec
		 	LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id 
			LEFT JOIN ole_base_area ba on bd.area_id = ba.id 
		 	LEFT JOIN ole_sys_dict sd2 ON sd2.enum_value = ec.flow_type AND sd2.type_value = '1802' 
			LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ec.case_status AND sd1.type_value = #{checkMode}
			LEFT JOIN ole_sys_dict sd ON sd.enum_value = ec.case_source AND sd.type_value = #{checkObjectType}
		<where>
			1=1
			<!--<if test="params.deptIds != null and params.deptIds != ''">
				and FIND_IN_SET (bd.id , #{params.deptId})
			</if>-->
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId} 
			</if>
			<if test="areaId != null and areaId != ''">
				and ba.id = #{areaId}
			</if>
			<if test="caseName != null and caseName != ''">
				and ec.case_name like concat('%', #{caseName}, '%')
			</if>
			<if test="caseStatus != null and caseStatus != ''">
				and ec.case_status = #{caseStatus}
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 1 ">
				AND  date(ec.create_date) = curdate()
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ec.create_date)		
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 5 ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ec.create_date)	
			</if>
		</where>
    </select>
    
    <!--PS PC 案件列表查询总数 -->
	<select id="getPcMessageNum" resultType="INTEGER" parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
      SELECT count(ec.id)
      	FROM ole_base_area ba
		LEFT JOIN
			ole_base_dept bd on bd.area_id = ba.id
		LEFT JOIN ole_ef_case ec on bd.id = ec.dept_id and ec.is_ps='1'
		<where>
			 bd.is_ps='1'
			 
			 AND ec.case_status=90 
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
		</where>
    </select>
    
    
	<!--PS查询日常检查列表总条数 -->
	<select id="getDailyNum" resultType="INTEGER" parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
      SELECT
			COUNT(ecd.id)
		FROM
			ole_ef_check_daily ecd  
		LEFT JOIN ole_base_dept bd ON ecd.dept_id=bd.id
		LEFT JOIN ole_base_area ba ON ba.id= bd.area_id
		LEFT JOIN ole_base_dept_person per ON per.ID= ecd.person_id
		LEFT JOIN ole_base_dept_person per1 ON per1.ID= ecd.assist_person_id
		LEFT JOIN ole_sys_dict sd2 ON sd2.enum_value = ecd.check_object_type and sd2.type_value = "1600"
		LEFT JOIN ole_sys_dict sd3 ON sd3.enum_value = ecd.`status` and sd3.type_value = "1502"
		<where>
			 bd.is_ps='1'
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
			<if test="areaId != null and areaId != ''">
				and ba.id = #{areaId}
			</if>
		</where>
    </select>
    
    <!--Api查询日常检查列表总条数 -->
	<select id="ApiDailyNum" resultType="INTEGER" parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
      SELECT
			COUNT(ecd.id)
		FROM
			ole_ef_check_daily ecd  
		LEFT JOIN ole_base_dept bd ON ecd.dept_id=bd.id
		LEFT JOIN ole_base_area ba ON ba.id= bd.area_id
		LEFT JOIN ole_base_dept_person per ON per.ID= ecd.person_id
		LEFT JOIN ole_base_dept_person per1 ON per1.ID= ecd.assist_person_id
		LEFT JOIN ole_sys_dict sd2 ON sd2.enum_value = ecd.check_object_type and sd2.type_value = "1600"
		LEFT JOIN ole_sys_dict sd3 ON sd3.enum_value = ecd.`status` and sd3.type_value = "1502"
		<where>
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
			<if test="areaId != null and areaId != ''">
				and ba.id = #{areaId}
			</if>
			<if test="checkTitle != null and checkTitle != ''">
				and ecd.check_title like concat('%', #{checkTitle}, '%')
			</if>
			<if test="checkMode != null and checkMode != ''">
				and ecd.check_mode like concat('%', #{checkMode}, '%')
			</if>
		</where>
    </select>
    
    <!--PS查询专项检查列表总条数 -->
	<select id="getSpecialNum" resultType="INTEGER" parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
      SELECT   
      		COUNT(DISTINCT ck.id) 
      FROM ole_ef_check ck
		LEFT JOIN ole_sys_dict dic ON ck.status = dic.enum_value AND dic.type_value = '1501'
		LEFT JOIN 
		(SELECT 
			ECP.check_id,
			ECP.dept_id deptId,
			GROUP_CONCAT( BDP.name) PERSONNAME 
		FROM ole_ef_check_person ECP , OLE_BASE_DEPT_PERSON BDP  
		WHERE FIND_IN_SET(BDP.ID,ECP.person_id)  GROUP BY CHECK_ID, ECP.dept_id ) CHECK_PERSON ON CK.id = CHECK_PERSON.CHECK_ID
		LEFT JOIN ole_base_dept bd ON bd.id = CHECK_PERSON.deptId
		LEFT JOIN ole_base_area ba ON ba.id= bd.area_id
		<where>
			 bd.is_ps='1'
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
			<if test="areaId != null and areaId != ''">
				and ba.id = #{areaId}
			</if>
		</where>
    </select>
    
     <!--API查询专项检查列表总条数 -->
	<select id="ApiSpecialNum" resultType="INTEGER" parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
      SELECT   COUNT(DISTINCT ck.id) FROM ole_ef_check ck
		LEFT JOIN ole_sys_dict dic ON ck.status = dic.enum_value AND dic.type_value = '1501'
		LEFT JOIN 
		(SELECT 
			ECP.check_id,
			ECP.dept_id deptId,
			GROUP_CONCAT( BDP.name) PERSONNAME 
		FROM ole_ef_check_person ECP , OLE_BASE_DEPT_PERSON BDP  
		WHERE FIND_IN_SET(BDP.ID,ECP.person_id)  GROUP BY CHECK_ID, ECP.dept_id ) CHECK_PERSON ON CK.id = CHECK_PERSON.CHECK_ID
		LEFT JOIN ole_base_dept bd ON bd.id = CHECK_PERSON.deptId
		LEFT JOIN ole_base_area ba ON ba.id= bd.area_id
		<where>
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
			<if test="areaId != null and areaId != ''">
				and ba.id = #{areaId}
			</if>
			<if test="checkMode != null and checkMode != ''">
				AND ck.status = #{checkMode}
			</if>
			<if test="checkTitle != 'null' and checkTitle != ''">
				AND ck.check_title like concat('%', #{checkTitle}, '%')
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 1 ">
				AND  date(ck.create_date) = curdate()
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ck.create_date)		
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ck.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ck.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 5 ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ck.create_date)	
			</if>
		</where>
    </select>
    
	<!--PS 案件列表按条件查询-->
	<select id="tjCaseList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT  ec.id caseId,
			bd.name name,
			ec.case_name caseName, 
			ec.case_num caseNum, 
			ec.case_address caseAddress,
			ec.brief_case_content briefCaseContent,
			ec.case_zzfryname caseZzfryname,
			ec.case_fzfryname caseFzfryname,
			sd.enum_desc caseStatus,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpdate,
			ba.name areaName,
			ec.flow_type flowType
			FROM ole_ef_case ec 
			LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id 
			LEFT JOIN ole_base_area ba on bd.area_id = ba.id 
			LEFT JOIN ole_sys_dict sd on ec.case_status=sd.enum_value and sd.type_value="1500"
		<where>
			bd.is_ps='1' and ec.is_ps='1'
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId} 
			</if>
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
		</where>
		order by ec.create_date desc
			LIMIT  #{startIndex},#{pageSize}
	</select>
	
	<!--API 一般案件列表按条件查询-->
	<select id="selectGeneralCaseList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT  ec.id caseId,
			bd.name name,
			ec.case_name caseName, 
			ec.case_num caseNum, 
			sd1.enum_desc caseSource,
			ec.case_address caseAddress,
			ec.brief_case_content briefCaseContent,
			ec.case_zzfryname caseZzfryname,
			ec.case_fzfryname caseFzfryname,
			sd.enum_desc caseStatus,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpdate,
			ba.name areaName,
			sd2.enum_desc flowType
			FROM ole_ef_case ec 
			LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id 
			LEFT JOIN ole_base_area ba on bd.area_id = ba.id 
			LEFT JOIN ole_sys_dict sd on ec.case_status=sd.enum_value and sd.type_value="1500"
			LEFT JOIN ole_sys_dict sd1 on ec.case_source=sd1.enum_value and sd1.type_value="1002"
			LEFT JOIN ole_sys_dict sd2 on ec.flow_type=sd2.enum_value and sd2.type_value="1802"
		<where>
			ec.flow_type=2
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId} 
			</if>
			<if test="areaId != null and areaId != ''">
				and ba.id = #{areaId}
			</if>
			<if test="caseName != null and caseName != ''">
				and ec.case_name like concat('%', #{caseName}, '%')
			</if>
		</where>
		order by ec.create_date desc
			LIMIT  #{startIndex},#{pageSize}
			
	</select>
	
	<!--Api根据登录人的部门查询一般简易案件最新列表-->
	<select id="selectGeneralSimple" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT  ec.id caseId,
			bd.name name,
			ec.case_name caseName, 
			ec.case_num caseNum, 
			sd1.enum_desc caseSource,
			ec.case_address caseAddress,
			ec.brief_case_content briefCaseContent,
			ec.case_zzfryname caseZzfryname,
			ec.case_fzfryname caseFzfryname,
			sd.enum_desc caseStatus,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpdate,
			ba.name areaName
			FROM ole_ef_case ec 
			LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id 
			LEFT JOIN ole_base_area ba on bd.area_id = ba.id 
			LEFT JOIN ole_sys_dict sd on ec.case_status=sd.enum_value and sd.type_value="1500"
			LEFT JOIN ole_sys_dict sd1 on ec.case_source=sd1.enum_value and sd1.type_value="1002"
		<where>
			(ec.flow_type=2 or ec.flow_type=1)
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId} 
			</if>
			<if test="caseName != null and caseName != ''">
				and ec.case_name like concat('%', #{caseName}, '%')
			</if>
		</where>
		order by ec.create_date desc
			LIMIT  #{startIndex},#{pageSize}
			
	</select>
	
	<!--API 重大案件列表按条件查询-->
	<select id="selectSeriousCaseList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT  ec.id caseId,
			bd.name name,
			ec.case_name caseName, 
			ec.case_num caseNum, 
			ec.case_address caseAddress,
			ec.brief_case_content briefCaseContent,
			ec.case_zzfryname caseZzfryname,
			ec.case_fzfryname caseFzfryname,
			sd.enum_desc caseStatus,
			sd1.enum_desc caseSource,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpdate,
			ec.case_time caseTime,
			ba.name areaName,
			sd2.enum_desc flowType
			FROM ole_ef_case ec 
			LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id 
			LEFT JOIN ole_base_area ba on bd.area_id = ba.id 
			LEFT JOIN ole_sys_dict sd on ec.case_status=sd.enum_value and sd.type_value="1500"
			LEFT JOIN ole_sys_dict sd1 on ec.case_source=sd1.enum_value and sd1.type_value="1002"
			LEFT JOIN ole_sys_dict sd2 on ec.flow_type=sd2.enum_value and sd2.type_value="1802"
		<where>
			ec.flow_type=3
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId} 
			</if>
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
			<if test="caseName != null and caseName != ''">
				and ec.case_name like concat('%', #{caseName}, '%')
			</if>
		</where> 
		order by ec.create_date desc
			LIMIT  #{startIndex},#{pageSize}
			
	</select>
	
	<!--API 重大案件列表按条件查询-->
	<select id="selectSeriousCaseListApp" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT  ec.id caseId,
			bd.name name,
			bd.id deptId,
			ec.case_name caseName, 
			ec.case_num caseNum, 
			ec.case_address caseAddress,
			ec.brief_case_content briefCaseContent,
			ec.case_zzfryname caseZzfryname,
			ec.case_fzfryname caseFzfryname,
			sd.enum_desc caseStatus,
			sd1.enum_desc caseSource,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpdate,
			ec.case_time caseTime,
			ba.name areaName,
			sd2.enum_desc flowType
			FROM ole_ef_case ec 
			LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id 
			LEFT JOIN ole_base_area ba on bd.area_id = ba.id 
			LEFT JOIN ole_sys_dict sd on ec.case_status=sd.enum_value and sd.type_value=#{checkMode}
			LEFT JOIN ole_sys_dict sd1 on ec.case_source=sd1.enum_value and sd1.type_value=#{checkObjectType}
			LEFT JOIN ole_sys_dict sd2 on ec.flow_type=sd2.enum_value and sd2.type_value="1802"
		<where>
			ec.flow_type=3
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
			<if test="caseName != null and caseName != ''">
				and ec.case_name like concat('%', #{caseName}, '%')
			</if>
		</where> 
		order by ec.create_date desc
		<if test="startIndex != null and endIndex != ''">
			limit #{startIndex}, #{endIndex};
		</if>
	</select>
	
	<!--API 重大案件列表按条件查询-->
	<select id="getSeriousNumApp" resultType="INTEGER">
		SELECT count(ec.id)
			FROM ole_ef_case ec 
			LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id 
			LEFT JOIN ole_base_area ba on bd.area_id = ba.id 
			LEFT JOIN ole_sys_dict sd on ec.case_status=sd.enum_value and sd.type_value=#{checkMode}
			LEFT JOIN ole_sys_dict sd1 on ec.case_source=sd1.enum_value and sd1.type_value=#{checkObjectType}
			LEFT JOIN ole_sys_dict sd2 on ec.flow_type=sd2.enum_value and sd2.type_value="1802"
		<where>
			ec.flow_type=3
			<!--<if test="deptIds != null and deptIds != ''">
				and FIND_IN_SET (bd.id ,#{deptIds})
			</if>-->
			<if test="deptId != null and deptId != ''">
				AND bd.id = #{deptId}
			</if>
			<if test="areaId != null and areaId != ''">
				and ba.id = #{areaId}
			</if>
			<if test="caseName != null and caseName != ''">
				and ec.case_name like concat('%', #{caseName}, '%')
			</if>
		</where> 
	</select>
	
	<!--API 已结案案件列表按条件查询-->
	<select id="selectCasecaseList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT  ec.id caseId,
			bd.name name,
			ec.case_name caseName, 
			ec.case_num caseNum, 
			ec.case_address caseAddress,
			ec.brief_case_content briefCaseContent,
			ec.case_zzfryname caseZzfryname,
			ec.case_fzfryname caseFzfryname,
			sd.enum_desc caseStatus,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpdate,
			ec.case_time caseTime,
			ba.name areaName
			FROM ole_ef_case ec 
			LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id 
			LEFT JOIN ole_base_area ba on bd.area_id = ba.id 
			LEFT JOIN ole_sys_dict sd on ec.case_status=sd.enum_value and sd.type_value="1500"
		<where>
			ec.case_status='90'
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId} 
			</if>
			<if test="caseName != 'null' and caseName != ''">
				and ec.case_name like concat('%', #{caseName}, '%')
			</if>
			<if test="isReview != null and isReview != ''  and  isReview==1 ">
				and ec.id  in (SELECT case_id FROM ole_ef_review_record)
			</if>
			<if test="isReview != null and isReview != ''  and  isReview==0 ">
				and ec.id  not   in (SELECT case_id FROM ole_ef_review_record)
			</if>
		</where>
		order by ec.create_date desc
		LIMIT  #{startIndex},#{pageSize}
			
	</select>
	
	<!--API 案件详情-->
	<select id="getCaseByCaseId" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT  ec.id caseId,
			bd.name name,
			ec.case_name caseName, 
			ec.case_reason caseReason,
			ec.case_num caseNum, 
			sd1.enum_desc caseSource,
			ec.case_address caseAddress,
			ec.brief_case_content briefCaseContent,
			ec.case_zzfryname caseZzfryname,
			ec.case_fzfryname caseFzfryname,
			sd.enum_desc caseStatus,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpdate,
			ba.name areaName,
			su.nickname caseZpr,
			ec.case_handler caseHandler,
			epi.name userName,
			sd2.enum_desc caseType,
			epi.unit_name unitName,
			epi.legal_name legelName,
			epi.org_id_card orgIdCard,
			epi.org_code orgCode,
			bplm.fz_content AS fzContent,
			epi.type AS checkObjectType
			FROM ole_ef_case ec 
			LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id 
			LEFT JOIN ole_base_area ba on bd.area_id = ba.id 
			LEFT JOIN ole_sys_dict sd on ec.case_status=sd.enum_value and sd.type_value="1500"
			LEFT JOIN ole_sys_dict sd1 on ec.case_source=sd1.enum_value and sd1.type_value="1002"
			LEFT JOIN ole_sys_dict sd2 on ec.case_type=sd2.enum_value and sd2.type_value="1003"
			LEFT JOIN ole_ef_party_info epi on epi.case_id=ec.id
			LEFT JOIN ole_base_potence_law_map bplm on bplm.right_duty_id = ec.potence_law_map_id AND ec.potence_id = bplm.id
			LEFT JOIN ole_sys_user su ON ec.case_zpr=su.id
		<where>
			<if test="caseIdMp.caseId != null and caseIdMp.caseId != ''">
				and ec.id = #{caseIdMp.caseId} 
			</if>
		</where>
	</select>
	
	<!--API 简易案件列表按条件查询-->
	<select id="selectSimpleCaseList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT  ec.id caseId,
			bd.name name,
			ec.case_name caseName, 
			ec.case_num caseNum, 
			sd1.enum_desc caseSource,
			ec.case_address caseAddress,
			ec.brief_case_content briefCaseContent,
			ec.case_zzfryname caseZzfryname,
			ec.case_fzfryname caseFzfryname,
			sd.enum_desc caseStatus,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpdate,
			ba.name areaName,
			sd2.enum_desc flowType
			FROM ole_ef_case ec 
			LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id 
			LEFT JOIN ole_base_area ba on bd.area_id = ba.id 
			LEFT JOIN ole_sys_dict sd on ec.case_status=sd.enum_value and sd.type_value="1500"
			LEFT JOIN ole_sys_dict sd1 on ec.case_source=sd1.enum_value and sd1.type_value="1002"
			LEFT JOIN ole_sys_dict sd2 on ec.flow_type=sd2.enum_value and sd2.type_value="1802"
		<where>
			ec.flow_type=1
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId} 
			</if>
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
			<if test="caseName != 'null' and caseName != ''">
				and ec.case_name like concat('%', #{caseName}, '%')
			</if>
		</where>
		order by ec.create_date desc
			LIMIT  #{startIndex},#{pageSize}
			
	</select>
	
	<!--API 本年案件列表按条件查询-->
	<select id="caseAllList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT  ec.id caseId,
			bd.name name,
			ec.case_name caseName, 
			ec.case_num caseNum, 
			sd1.enum_desc caseSource,
			ec.case_address caseAddress,
			ec.brief_case_content briefCaseContent,
			ec.case_zzfryname caseZzfryname,
			ec.case_fzfryname caseFzfryname,
			sd.enum_desc caseStatus,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpdate,
			ba.name areaName,
			sd2.enum_desc flowType
			FROM ole_ef_case ec 
			LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id 
			LEFT JOIN ole_base_area ba on bd.area_id = ba.id 
			LEFT JOIN ole_sys_dict sd on ec.case_status=sd.enum_value and sd.type_value="1500"
			LEFT JOIN ole_sys_dict sd1 on ec.case_source=sd1.enum_value and sd1.type_value="1002"
			LEFT JOIN ole_sys_dict sd2 on ec.flow_type=sd2.enum_value and sd2.type_value="1802"
		<where>
			1=1
			<!-- YEAR(ec.create_date)=YEAR(NOW()) -->
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId} 
			</if>
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
			<if test="caseStatus != null and caseStatus != ''">
				and ec.case_status = #{caseStatus}
			</if>
			<if test="caseName != 'null' and caseName != ''">
				and ec.case_name like concat('%', #{caseName}, '%')
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 1 ">
				AND  date(ec.create_date) = curdate()
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ec.create_date)		
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 5 ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ec.create_date)	
			</if>
		</where>
		order by ec.create_date desc
			LIMIT  #{startIndex},#{pageSize}
			
	</select>
	
	<!--API 本年案件列表按条件查询-->
	<select id="caseAllListMap" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT  ec.id as caseId,
			ec.case_name AS caseName, 
			ec.case_name AS name,
			ec.case_num AS caseNum, 
			sd.enum_desc AS caseSource,
			ec.dept_id AS deptId,
			bd.name AS deptName,
			ec.case_address caseAddress,
			ec.case_zzfryname As caseZzfryname,
			ec.case_apply_date AS caseApplyDate,
			ec.brief_case_content AS briefCaseContent,
			ec.case_handler AS caseHandler,
			ec.case_zpr AS caseZpr,
			ec.case_zpdate AS caseZpdate,
			ec.case_zzfryid AS caseZzfryid,
			ec.case_zzfryname AS caseZzfryname,
			ec.case_fzfryid AS caseFzfryid,
			ec.case_fzfryname AS caseFzfryname,
			ec.case_type AS caseType,
			ec.case_reason AS caseReason,
			ec.case_time AS caseTime,
			ec.check_id AS checkId,
			sd1.enum_desc AS caseStatus,
			sd2.enum_desc AS flowType
			FROM ole_ef_case ec 
			LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id 
			LEFT JOIN ole_base_area ba on bd.area_id = ba.id 
		 	LEFT JOIN ole_sys_dict sd2 ON sd2.enum_value = ec.flow_type AND sd2.type_value = '1802' 
			LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ec.case_status AND sd1.type_value = #{checkMode}
			LEFT JOIN ole_sys_dict sd ON sd.enum_value = ec.case_source AND sd.type_value = #{checkObjectType}
		<where>
			1=1
			<!--<if test="deptId != null and deptId != ''">
				and ec.dept_id = #{deptId}
			</if>
			<if test="deptIds != null and deptIds != ''">
				and FIND_IN_SET (ec.dept_id ,#{deptIds})
			</if>-->
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId} 
			</if>
			<if test="areaId != null and areaId != ''">
				and ba.id = #{areaId}
			</if>
			<if test="caseName != null and caseName != ''">
				and ec.case_name like concat('%', #{caseName}, '%')
			</if>
			<if test="caseStatus != null and caseStatus != ''">
				and ec.case_status = #{caseStatus}
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 1 ">
				AND  date(ec.create_date) = curdate()
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ec.create_date)		
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 5 ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ec.create_date)	
			</if>
		</where>
		order by ec.create_date desc
			LIMIT  #{startIndex},#{endIndex}
			
	</select>
	
	
	<!--PS PC 案件列表按条件查询-->
	<select id="tjPcCaseList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT  ec.id caseId,
			bd.name name,
			ec.case_name caseName, 
			ec.case_num caseNum, 
			ec.case_address caseAddress,
			ec.brief_case_content briefCaseContent,
			ec.case_zzfryname caseZzfryname,
			ec.case_fzfryname caseFzfryname,
			sd.enum_desc caseStatus,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpdate,
			ba.name areaName,
			ec.flow_type flowType
			FROM ole_base_area ba
			LEFT JOIN ole_base_dept bd on bd.area_id = ba.id and bd.is_ps='1'
			LEFT JOIN ole_ef_case ec on bd.id = ec.dept_id and ec.is_ps='1'
			LEFT JOIN ole_sys_dict sd on ec.case_status=sd.enum_value and sd.type_value="1500"
		<where>
			ec.case_status=90
			
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId} 
			</if>
			<if test="areaId != null and areaId != ''">
				and bd.area_id = #{areaId}
			</if>
		</where>
		order by ec.id
			LIMIT  #{startIndex},#{pageSize}
			
	</select>
	
	<!--PS 案件列表按条件查询-->
	<select id="apiCaseByAreaId" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT  ec.id caseId,
			bd.name name,
			ec.case_name caseName, 
			ec.case_num caseNum, 
			ec.case_address caseAddress,
			ec.brief_case_content briefCaseContent,
			ec.case_zzfryname caseZzfryname,
			ec.case_fzfryname caseFzfryname,
			ec.case_status caseStatus,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpdate,
			ba.name areaName
			FROM ole_ef_case ec 
			LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id
			LEFT JOIN ole_base_area ba on bd.area_id = ba.id
		<where>
			<!-- <if test="params.deptId != null and params.deptId != ''">
				and bd.id = #{params.deptId} 
			</if> -->
			<if test="params.areaId != null and params.areaId != ''">
				and bd.area_id = #{params.areaId}
			</if>
		</where>
	</select>
	
	<!--PS 案件列表查询总数 -->
	<select id="getSelectNum" resultType="INTEGER" parameterType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
      SELECT count(ec.id)
      	FROM ole_ef_case ec
      	LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id
		LEFT JOIN ole_ef_party_info epi on epi.case_id = ec.id
		<where>
			 ec.is_ps='1'
			<if test="caseName != null and caseName != ''">
				and ec.case_name like concat('%', #{caseName}, '%')
			</if>
			<if test="personName != null and personName != ''">
				and epi.name like concat('%', #{personName}, '%')
			</if>
			<if test="personNum != null and personNum != ''">
				and epi.id_card = #{personNum}
			</if>
			<if test="personTel != null and personTel != ''">
				and epi.tel = #{personTel}
			</if>
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
		</where>
    </select>
	<!--PS 根据案件名称，当事人姓名、电话、身份证查询案件-->
	<select id="selectCase" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT  ec.id caseId,
			bd.name name,
			ec.case_name caseName, 
			ec.case_num caseNum, 
			ec.case_address caseAddress,
			ec.brief_case_content briefCaseContent,
			ec.case_zzfryname caseZzfryname,
			ec.case_fzfryname caseFzfryname,
			ec.case_status caseStatus,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpdate,
			ec.flow_type flowType
			FROM ole_ef_case ec 
			LEFT JOIN ole_base_dept bd on bd.id = ec.dept_id
			LEFT JOIN ole_ef_party_info epi on epi.case_id = ec.id
		<where>
			ec.is_ps='1'
			<if test="caseName != null and caseName != ''">
				and ec.case_name like concat('%', #{caseName}, '%')
			</if>
			<if test="personName != null and personName != ''">
				and epi.name like concat('%', #{personName}, '%')
			</if>
			<if test="personNum != null and personNum != ''">
				and epi.id_card = #{personNum}
			</if>
			<if test="personTel != null and personTel != ''">
				and epi.tel = #{personTel}
			</if>
			<if test="deptId != null and deptId != ''">
				and bd.id = #{deptId}
			</if>
		</where>
		order by ec.id
		LIMIT  #{startIndex},#{pageSize}
	</select>
	
	<!-- 获取案件详情  反显 -->
	<select id="getCaseDTO" resultType="com.orhonit.ole.enforce.dto.CaseDTO">
		SELECT 
			EF.ID caseId , 
			EF.CASE_NAME caseName, 
			SD.ENUM_DESC caseSource, 
			EF.case_address caseAddress,
			ef.case_apply_date caseApplyDate,
			ef.brief_case_content briefCaseContent, 
			ef.case_handler caseHandler, 
			SU.NICKNAME caseZpr,
			EF.CASE_ZPDATE caseZpdate, 
			ef.case_zzfryname caseZzfryname, 
			ef.case_fzfryname caseFzfryname,
			ef.case_zzfryid caseZzfryid, 
			ef.case_fzfryid caseFzfryid,
			SDCS.enum_desc AS caseStatus, 
			ef.case_num caseNum, 
			ef.update_date caseUpdateDate, 
			SDCT.enum_desc caseType,
			ef.case_time caseTime,
			EF.case_reason AS caseReason
		FROM OLE_EF_CASE EF 
			LEFT JOIN OLE_SYS_DICT SD ON EF.CASE_SOURCE = SD.ENUM_VALUE AND SD.TYPE_VALUE = '1002'
			LEFT JOIN OLE_SYS_DICT SDCS ON EF.CASE_STATUS = SDCS.ENUM_VALUE AND SDCS.TYPE_VALUE = '1500'
			LEFT JOIN OLE_SYS_DICT SDCT ON EF.CASE_TYPE = SDCT.ENUM_VALUE AND SDCT.TYPE_VALUE = '1003'
			LEFT JOIN OLE_SYS_USER SU ON EF.CASE_ZPR = SU.ID 
		WHERE EF.ID = #{caseId};
	</select>
	
	<select id="findCaseList" resultType="com.orhonit.ole.enforce.dto.api.ApiCaseListDTO">
		SELECT case_num as caseNum,
			   case_name as caseName,
			   case_time as caseTime,
			   SD.ENUM_DESC caseSource,
			   SDCS.enum_desc AS caseStatus,
			   ec.case_address as caseAddress,
			   ec.case_zzfryname as caseZzfryname,
			   ec.case_fzfryname as caseFzfryname,
			   SDC1.ENUM_DESC as flowType
		FROM ole_ef_case ec
		LEFT JOIN OLE_SYS_DICT SD ON ec.CASE_SOURCE = SD.ENUM_VALUE AND SD.TYPE_VALUE = '1002'
		LEFT JOIN OLE_SYS_DICT SDCS ON ec.CASE_STATUS = SDCS.ENUM_VALUE AND SDCS.TYPE_VALUE = '1500'
		LEFT JOIN OLE_SYS_DICT SDC1 ON ec.flow_type = SDC1.ENUM_VALUE AND SDC1.TYPE_VALUE = '1803'
		<where>
				ec.dept_id = #{params.deptId}				
				AND (ec.case_zzfryid = #{params.personId} 
					or ec.case_fzfryid like concat('%', #{params.personId}, '%') ) 
			<if test="params.status != null and params.status != ''">
				AND ec.case_status = #{params.status}
			</if>	
			<if test="params.caseName != null and params.caseName != ''">
				AND ec.case_name like concat('%', #{params.caseName}, '%')
			</if>
			<if test="params.flowType != null and params.flowType != ''">
				AND ec.flow_type = #{params.flowType}
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 1 ">
				AND  date(ec.create_date) = curdate()
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ec.create_date)		
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 5  ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ec.create_date)	
			</if>
			ORDER BY EC.create_date DESC
			<if test="params.startNo != null and params.endNo !=null">
				LIMIT #{params.startNo},#{params.endNo}
			</if>
		</where>
		
		;
	</select>
	
	<select id="findCaseInfo" resultType="com.orhonit.ole.enforce.dto.api.ApiCaseInfoDTO">
		     SELECT 
				   ec.id as caseId,
				   ec.case_num as caseNum,
				   ec.case_name as caseName,
				   ec.case_time as caseTime,
				   ec.brief_case_content as briefCaseContent,
				   ec.case_address as caseAddress,
				   ec.case_apply_date as caseApplyDate,
				   ec.case_handler as caseHandler,
				   su.nickname as caseZpr,
				   ec.case_zpdate as caseZpdate,
				   ec.case_zzfryid as caseZzfryid,
				   ec.case_zzfryname as caseZzfryname,
				   ec.case_fzfryid as caseFzfryid, 
				   ec.case_fzfryname as caseFzfryname,
				   sd.enum_desc as caseSource,
				   SDCS.enum_desc AS caseStatus ,
				   ec.flow_type as flowType,
				   ep.id as partyInfoId,
				   ep.name ,
				   ep.post_code as postCode ,
				   ep.id_card as idCard,
				   sdi.enum_desc as sex ,
				   ep.age,ep.tel,ep.address,
				   ep.unit_address as unitAddress,
				   ep.unit_name as unitName,
				   ep.legal_name as legalName,
				   ep.org_id_card as orgIdCard,
				   ep.org_code as orgCode,
				   sde.enum_desc as type, 
				   syct.enum_desc as caseType,
				   ec.case_reason as caseReason,
				   bp.name as potence,
				   GROUP_CONCAT(bplm.fz_content)AS fzContent,
				   ec.lng as lng,
				   ec.lat as lat,
				   ec.dept_id as deptId,
				   ec.punish_type as punishType,
				   ec.punish_cash as punishCash,
				   ec.punish_bill as punishBill
			FROM ole_ef_case ec 
			left join  ole_ef_party_info ep on ec.id = ep.case_id 			
			LEFT JOIN ole_base_potence_law_map bplm ON FIND_IN_SET(bplm.right_duty_id,ec.potence_id) AND FIND_IN_SET(bplm.id,ec.potence_law_map_id)
			left join  ole_base_potence bp on ec.potence_id=bp.id
			left join  ole_sys_dict sd on ec.case_source=sd.enum_value and sd.type_value='1002'
			left join  ole_sys_dict sde on ep.type=sde.enum_value and sde.type_value='1600'
			left join  ole_sys_dict syct on ec.case_type=syct.enum_value and syct.type_value='1003'
			LEFT JOIN OLE_SYS_DICT SDCS ON ec.CASE_STATUS = SDCS.ENUM_VALUE AND SDCS.TYPE_VALUE = '1500'
			left join  ole_sys_dict sdi on ep.sex=sdi.enum_value and sdi.type_value='1700'
			left join  ole_sys_user su on su.id=ec.case_zpr
			<where>
				1=1
			<if test="params.caseNum != null and params.caseNum != ''">
				AND ec.case_num = #{params.caseNum}
			</if>	
		</where>
		;
	</select>

	
	<!-- 各辖区案件数量统计-->
	<select id="psCaseList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ec.id) caseNum,
			ba.id areaId,
			ba.name areaName,
			bd.id deptId,
			bd.name deptName
		FROM
			ole_base_area ba
		LEFT JOIN ole_base_dept bd ON bd.area_id = ba.id and bd.is_ps="1"
		LEFT JOIN ole_ef_case ec ON ec.dept_id = bd.id and ec.is_ps="1"
		WHERE LENGTH(ba.`code`)=6
		GROUP BY
			ba.name
	</select>
	
	<!-- 各辖区已结案案件数量统计-->
	<select id="caseCaseNumByDept" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ec.id) caseNum,
			bd.id deptId,
			bd.name deptName
		FROM
			ole_ef_case ec
		LEFT JOIN ole_base_dept bd ON ec.dept_id = bd.id 
		WHERE ec.case_status=90 AND bd.id= #{params.deptId}
	</select>
	
	<!-- 各辖区已结案案件数量统计-->
	<select id="caseCaseNumByArea" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ec.id) caseNum,
			bd.id deptId,
			bd.name deptName
		FROM
			ole_base_dept bd
		LEFT JOIN ole_ef_case ec ON ec.dept_id = bd.id 
		WHERE ec.case_status=90
		GROUP BY
			bd.name
	</select>
	
	<!-- PC各辖区案件数量统计-->
	<select id="psPcCaseList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ec.id) caseNum,
			ba.id areaId,
			ba.name areaName
		FROM
			ole_base_area ba
		LEFT JOIN ole_base_dept bd ON bd.area_id = ba.id
		LEFT JOIN ole_ef_case ec ON ec.dept_id = bd.id and ec.case_status=90 AND ec.is_ps='1'
		WHERE LENGTH(ba.`code`)=6
		GROUP BY
			ba.name
	</select>
	
	<!-- 查询各部门案件统计-->
	<select id="selectCaseList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ec.id) caseNum,
			bd.id deptId,
			bd.name deptName
		FROM
			ole_base_dept bd  
		LEFT JOIN ole_ef_case ec ON ec.dept_id = bd.id
		<where>
		 	ec.is_ps="1" and bd.is_ps='1'
			<if test="params.deptName != null and params.deptName != ''">
				AND bd.name like concat('%', #{params.deptName}, '%')
			</if>
		</where> 
			
		GROUP BY
			bd.id
	</select>
	
	<!-- 查询各部门日常检查统计-->
	<select id="selectDailyCaseList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ecd.id) caseNum,
			bd.id deptId,
			bd. NAME deptName
		FROM
			ole_base_dept bd
		LEFT JOIN ole_ef_check_daily ecd ON ecd.dept_id = bd.id 
		<where>
			 bd.is_ps="1"
			 <if test="params.deptName != null and params.deptName != ''">
				AND bd.name like concat('%', #{params.deptName}, '%')
			</if>
		</where>
		GROUP BY
			bd.id
	</select>
	
	<!-- 查询各地区日常检查统计-->
	<select id="dailyList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ecd.id) caseNum,
			ba.id areaId,
			ba.`name` areaName
		FROM
			ole_base_area ba
		RIGHT JOIN ole_base_dept bd ON bd.area_id=ba.id AND bd.is_ps="1"
		RIGHT JOIN ole_ef_check_daily ecd ON ecd.dept_id=bd.id
		WHERE
			LENGTH(ba.`code`)=6
		GROUP BY
			ba.id
	</select>
	
	<!-- 查询各地区日常检查统计-->
	<select id="LdDailyNumByDept" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ecd.id) caseNum,
			ba.id areaId,
			ba.`name` areaName
		FROM
			ole_base_area ba
		RIGHT JOIN ole_base_dept bd ON bd.area_id=ba.id
		RIGHT JOIN ole_ef_check_daily ecd ON ecd.dept_id=bd.id 
		<!--and YEAR(ecd.create_date)=YEAR(NOW())-->
		WHERE
			LENGTH(ba.`code`)=6
		GROUP BY
			ba.id
	</select>
	
	<!-- API检查状态查询-->
	<select id="checkStatusByDeptId" resultType="com.orhonit.ole.enforce.dto.api.ApiCheckTypeDTO">
		SELECT ect.id as id,
		ect.title as title
		FROM ole_ef_check_type ect WHERE ect.dept_id=#{params.deptId} and ect.del_flag=0
	</select>
	
	<!-- 查询各部门日常检查统计-->
	<select id="dailyByDeptAll" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ecd.id) caseNum,
			bd.id deptId,
			bd.`name` deptName
		FROM
			ole_base_area ba
		RIGHT JOIN ole_base_dept bd ON bd.area_id=ba.id
		RIGHT JOIN ole_ef_check_daily ecd ON ecd.dept_id=bd.id 
		<!--and YEAR(ecd.create_date)=YEAR(NOW())-->
		WHERE
			LENGTH(ba.`code`)=6
			and ba.id = #{params.areaId}
		GROUP BY
			bd.id
	</select>
	
	<!-- API领导端日常检查统计-->
	<select id="LdDailyNum" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ecd.id) ricCount,
			ba.id areaId,
			ba.name areaName,
			bd.id deptId,
			bd.name deptName
		FROM ole_ef_check_daily ecd
		LEFT JOIN ole_base_dept bd ON ecd.dept_id=bd.id
		LEFT JOIN ole_base_area ba ON ba.id= bd.area_id
		<where>
			1=1
			<!--YEAR(ecd.create_date)=YEAR(NOW())-->
			<if test="params.deptId != null and params.deptId != ''">
				and ecd.dept_id = #{params.deptId}
			</if>	
		</where>
	</select>
	
	<!-- API领导端日常检查统计 新加的 不确定用哪个-->
	<select id="LdDailyNumMap" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ecd.id) ricCount,
			ba.id areaId,
			ba.name areaName,
			bd.id deptId,
			bd.name deptName
		FROM ole_ef_check_daily ecd
		LEFT JOIN ole_base_dept bd ON ecd.dept_id=bd.id
		LEFT JOIN ole_base_area ba ON ba.id= bd.area_id
		LEFT JOIN ole_base_dept_person per ON per.ID= ecd.person_id
		LEFT JOIN ole_base_dept_person per1 ON per1.ID= ecd.assist_person_id
		LEFT JOIN ole_sys_dict sd2 ON sd2.enum_value = ecd.check_object_type and sd2.type_value = #{params.checkObjectType}
		LEFT JOIN ole_sys_dict sd3 ON sd3.enum_value = ecd.status and sd3.type_value = #{params.checkStutas}
		<where>
			1=1
			<if test="params.deptIds != null and params.deptIds != ''">
				and FIND_IN_SET (bd.id ,#{params.deptIds})
			</if>
			<if test="params.areaId != null and params.areaId != ''">
				AND ba.id = #{params.areaId}
			</if>
		</where>
	</select>
	
	<!-- API一般案件统计-->
	<select id="generalCaseNum" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
		 	COUNT(ef.id) caseNum,
			flow_type flowType,
			bd.name deptName
		 	from ole_base_dept bd
		 	LEFT JOIN ole_ef_case ef on ef.dept_id=bd.id
		<where>
		flow_type=2
			<if test="params.deptId != null and params.deptId != ''">
				and ef.dept_id = #{params.deptId}
			</if>	
		</where>
	</select>
	
	<!-- API本年所有案件统计-->
	<select id="caseAll" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
		 	COUNT(ef.id) caseNum,
			ef.flow_type flowType,
			bd.id deptId,
			bd.name deptName
		 	from ole_ef_case ef
			LEFT JOIN ole_base_dept bd ON bd.id = ef.dept_id
			LEFT JOIN ole_base_area ba ON ba.id= bd.area_id
		<where>
			1=1
			<if test="params.deptIds != null and params.deptIds != ''">
				and ef.dept_id = #{params.deptIds}
			</if>
			<if test="params.areaId != null and params.areaId != ''">
				AND ba.id = #{params.areaId}
			</if>
		</where>
	</select>
	
	<!-- API本年所有案件统计-->
	<select id="caseAllsss" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
		 	COUNT(ef.id) caseNum,
			flow_type flowType,
			bd.id deptId,
			bd.name deptName
		 	from ole_base_dept bd
		 	RIGHT JOIN ole_ef_case ef on ef.dept_id=bd.id
		<where>
			1=1
			<if test="params.deptIds != null and params.deptIds != ''">
				and ef.dept_id = #{params.deptIds}
			</if>
			<if test="params.areaId != null and params.areaId != ''">
				AND ba.id = #{params.areaId}
			</if>
		</where>
	</select>
	
	<!-- API本年所有案件统计 新加的 -->
	<select id="caseAllMap" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
		 	COUNT(ec.id) caseNum,
			flow_type flowType,
			bd.id deptId,
			bd.name deptName
		 	FROM ole_ef_case ec
		 	LEFT JOIN ole_sys_dict sd2 ON sd2.enum_value = ec.flow_type AND sd2.type_value = '1802' 
			LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ec.case_status AND sd1.type_value = #{params.checkMode}
			LEFT JOIN ole_sys_dict sd ON sd.enum_value = ec.case_source AND sd.type_value = #{params.checkObjectType}
			LEFT JOIN ole_base_dept bd ON bd.id = ec.dept_id
		<where>
			1=1
			<!-- YEAR(ec.create_date)=YEAR(NOW()) -->
			<if test="params.deptIds != null and params.deptIds != ''">
				and FIND_IN_SET (bd.id , #{params.deptId})
			</if>	
		</where>
	</select>
	
	<!-- API本年所有预警统计-->
	<select id="yujCount" resultType="com.orhonit.ole.enforce.dto.api.ApiYujDTO">
		SELECT
		 	COUNT(distinct owi.id) yujCount,
		 	bd.name deptName,
		 	bd.id deptId
		 	FROM ole_warn_info owi
		 	LEFT JOIN ole_warn_person wp on wp.warn_id=owi.id
		 	LEFT JOIN ole_base_dept bd ON wp.dept_id=bd.id
		<where>
			<!--YEAR(owi.create_date)=YEAR(NOW())-->
			<if test="params.deptId != null and params.deptId != ''">
				and bd.id = #{params.deptId}
			</if>	
		</where>
	</select>
	
	<!-- API本年所有预警统计 新加的-->
	<select id="yujCountMap" resultType="com.orhonit.ole.enforce.dto.api.ApiYujDTO">
		SELECT
		 	COUNT(distinct ec.id) yujCount,
		 	bd.name deptName,
		 	bd.id deptId
		 	FROM ole_warn_info ec
		 	LEFT JOIN ole_warn_person wp ON wp.warn_id=ec.id
			LEFT JOIN ole_base_dept bd ON wp.dept_id=bd.id
			LEFT JOIN ole_base_area ba ON ba.id= bd.area_id
			LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ec.level AND sd1.type_value = '1900'
			LEFT JOIN ole_sys_dict sd2 ON sd2.enum_value = ec.type AND sd2.type_value = '2020'
			LEFT JOIN ole_sys_dict sd3 ON sd3.enum_value = ec.warn_type AND sd3.type_value ='2051'
			LEFT JOIN ole_sys_dict sd4 ON sd4.enum_value = ec.flow_type AND sd4.type_value = '1802'
			LEFT JOIN ole_sys_dict sd ON sd.enum_value = wp.is_deal AND sd.type_value ='2056'
			LEFT JOIN ole_sys_dict sd5 ON sd5.enum_value = ec.record_status AND 
			(sd5.type_value ='1500' or sd5.type_value ='1501')
		<where>
			1=1
			<if test="params.deptIds != null and params.deptIds != ''">
				and FIND_IN_SET (bd.id, #{params.deptIds})
			</if>
			<if test="params.areaId != null and params.areaId != ''">
				AND ba.id = #{params.areaId}
			</if>
		</where>
	</select>
	
	<!-- API本年所有预警分区域统计-->
	<select id="yujCountByArea" resultType="com.orhonit.ole.enforce.dto.api.ApiYujDTO">
		SELECT
			COUNT(distinct owi.id) yujCount,
		 	ba.id areaId,
			ba.`name` areaName,
			bd.name deptName,
			bd.id deptId
		FROM
			ole_base_area ba
		RIGHT JOIN ole_base_dept bd ON bd.area_id= ba.id
		RIGHT JOIN ole_warn_person wp ON wp.dept_id=bd.id
		RIGHT JOIN ole_warn_info owi ON wp.warn_id=owi.id 
		<!--and YEAR(owi.create_date)=YEAR(NOW())-->
		WHERE
			LENGTH(ba.`code`)=6
		GROUP BY
			ba.id
	</select>
	
	<!-- API本年所有预警分部门统计-->
	<select id="yujCountByAreaAll" resultType="com.orhonit.ole.enforce.dto.api.ApiYujDTO">
		SELECT
			COUNT(distinct owi.id) yujCount,
		 	ba.id areaId,
			ba.`name` areaName,
			bd.name deptName,
			bd.id deptId
		FROM
			ole_base_area ba
		RIGHT JOIN ole_base_dept bd ON bd.area_id= ba.id
		RIGHT JOIN ole_warn_person wp ON wp.dept_id=bd.id
		RIGHT JOIN ole_warn_info owi ON wp.warn_id=owi.id 
		<!--and YEAR(owi.create_date)=YEAR(NOW())-->
		WHERE
			LENGTH(ba.`code`)=6
			and ba.id = #{params.areaId}
		GROUP BY
			bd.id
	</select>
		
	<!-- API简易案件统计-->
	<select id="simpleCaseNum" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
		 	COUNT(ef.id) caseNum,
			flow_type flowType,
			bd.name deptName
		 	from ole_base_dept bd
		 	LEFT JOIN ole_ef_case ef on ef.dept_id=bd.id
		<where>
			flow_type=1
			<if test="params.deptId != null and params.deptId != ''">
				and ef.dept_id = #{params.deptId}
			</if>	
		</where>
	</select>
	
	<!-- API重大案件统计-->
	<select id="SeriousCaseNum" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
		 	COUNT(ef.id) caseNum,
			flow_type flowType,
			bd.name deptName
		from ole_base_dept bd
		LEFT JOIN ole_ef_case ef on ef.dept_id=bd.id
		<where>
			flow_type=3
			<if test="params.deptId != null and params.deptId != ''">
			 and ef.dept_id = #{params.deptId}
			</if>	
		</where>
	</select>
	
	<!-- 查询各地区专项检查统计-->
	<select id="specialList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ecd.id) caseNum,
			ba.id areaId,
			ba.`name` areaName
		FROM
			ole_base_area ba
		LEFT JOIN ole_base_dept bd  ON bd.area_id= ba.id
		LEFT JOIN ole_ef_check_person bdp ON bdp.dept_id= bd.id
		LEFT JOIN ole_ef_check ecd ON ecd.id=bdp.check_id
		WHERE
			LENGTH(ba.`code`)=6
		GROUP BY
			ba.id
	</select>
	
	<!-- API查询各地区专项检查统计-->
	<select id="LdSpecialNumByDept" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ecd.id) caseNum,
			ba.id areaId,
			ba.`name` areaName,
			bd.name deptName,
			bd.id deptId
		FROM
			ole_base_area ba
		RIGHT JOIN ole_base_dept bd  ON bd.area_id= ba.id
		RIGHT JOIN ole_ef_check_person bdp ON bdp.dept_id= bd.id
		RIGHT JOIN ole_ef_check ecd ON ecd.id=bdp.check_id 
		<!--and YEAR(ecd.create_date)=YEAR(NOW())-->
		WHERE
			LENGTH(ba.`code`)=6
			
		GROUP BY
			ba.id
	</select>
	
	<!-- API查询各地区专项检查统计-->
	<select id="specialByDeptAll" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ecd.id) caseNum,
			bd.name deptName,
			bd.id deptId
		FROM
			ole_base_area ba
		RIGHT JOIN ole_base_dept bd ON bd.area_id= ba.id
		RIGHT JOIN ole_ef_check_person bdp ON bdp.dept_id= bd.id
		RIGHT JOIN ole_ef_check ecd ON ecd.id=bdp.check_id 
		<!--and YEAR(ecd.create_date)=YEAR(NOW())-->
		WHERE
			LENGTH(ba.`code`)=6
			and ba.id = #{params.areaId}
		GROUP BY
			bd.id
	</select>
	
	<!-- API查询各地区本年案件统计-->
	<select id="caseAllByArea" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ecd.id) caseNum,
			ba.id areaId,
			ba.`name` areaName,
			bd.name deptName,
			bd.id deptId
		FROM
			ole_base_area ba
		RIGHT JOIN ole_base_dept bd  ON bd.area_id= ba.id
		RIGHT JOIN ole_ef_check_person bdp ON bdp.dept_id= bd.id
		RIGHT JOIN ole_ef_check ecd ON ecd.id=bdp.check_id 
		<!--and YEAR(ecd.create_date)=YEAR(NOW())-->
		WHERE
			LENGTH(ba.`code`)=6
		GROUP BY
			ba.id
	</select>
	
	<!-- API查询各部门本年案件统计-->
	<select id="caseAllByAreaAll" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ecd.id) caseNum,
			bd.name deptName,
			bd.id deptId
		FROM
			ole_ef_case ecd
		RIGHT JOIN ole_base_dept bd ON ecd.dept_id=bd.id
		RIGHT JOIN ole_base_area ba ON bd.area_id = ba.id
		WHERE LENGTH(ba.`code`)=6 and ba.id = #{params.areaId} 
		<!--AND YEAR(ecd.create_date)=YEAR(NOW())-->
		GROUP BY
			bd.id
	</select>
	
	<!-- API查询各地区一般案件统计-->
	<select id="generalCaseNumByDept" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ec.id) caseNum,
			ba.id areaId,
			ba.name areaName
		FROM
			ole_base_area ba
		LEFT JOIN ole_base_dept bd ON bd.area_id = ba.id
		LEFT JOIN ole_ef_case ec ON ec.dept_id = bd.id AND ec.flow_type=2
		WHERE LENGTH(ba.`code`)=6 
		GROUP BY
			ba.name
	</select>
	
	<!-- API查询各地区一般和简易案件分部门统计-->
	<select id="generalCaseDept" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ec.id) caseNum,
			bd.id deptId,
			bd.name deptName
		FROM
			ole_base_dept bd
		LEFT JOIN ole_ef_case ec ON ec.dept_id = bd.id
		<where>
			<if test="params.areaId != null and params.areaId != ''">
				AND bd.area_id = #{params.areaId}
			</if>	
			<if test="params.deptId != null and params.deptId != ''">
				AND bd.id = #{params.deptId}
			</if>
			<if test="params.type != null and params.type != ''">
				AND ec.flow_type = #{params.type}
			</if>	
		</where>
		GROUP BY
			bd.name
	</select>
	
	<!-- API查询各地区简易案件统计-->
	<select id="simpleCaseNumByDept" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ec.id) caseNum,
			ba.id areaId,
			ba.name areaName
		FROM
			ole_base_area ba
		LEFT JOIN ole_base_dept bd ON bd.area_id = ba.id
		LEFT JOIN ole_ef_case ec ON ec.dept_id = bd.id AND flow_type=1
		WHERE LENGTH(ba.`code`)=6 
		GROUP BY
			ba.name
	</select>
	
	<!-- API查询各地区重大案件统计-->
	<select id="SeriousCaseByDept" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ec.id) caseNum,
			ba.id areaId,
			ba.name areaName
		FROM
			ole_base_area ba
		LEFT JOIN ole_base_dept bd ON bd.area_id = ba.id
		LEFT JOIN ole_ef_case ec ON ec.dept_id = bd.id 
		WHERE LENGTH(ba.`code`)=6 
			AND flow_type=3
		GROUP BY
			ba.name
	</select>
	
	<!-- API专项检查统计-->
	<select id="LdSpecialNum" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ecd.id) zhuanxCount,
			ba.id areaId,
			ba.`name` areaName,
			bd.name deptName,
			bd.id deptId
		FROM
		   ole_ef_check ecd
		LEFT JOIN ole_ef_check_person bdp ON ecd.id=bdp.check_id
		LEFT JOIN ole_base_dept bd ON bdp.dept_id = bd.id
		LEFT JOIN ole_base_area ba ON bd.area_id = ba.id
		<where>
			1=1
			<!--YEAR(ecd.create_date)=YEAR(NOW())-->
			<if test="params.deptId != null and params.deptId != ''">
				and bdp.dept_id = #{params.deptId}
			</if>	
		</where>
	</select>
	
	<!-- API专项检查统计不确定所以加了一个查询-->
	<select id="LdSpecialNumMap" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ck.id) zhuanxCount,
			ba.id areaId,
			ba.name areaName,
			bd.name deptName,
			bd.id deptId
		FROM
		   ole_ef_check ck
		LEFT JOIN ole_sys_dict dic ON ck.STATUS = dic.enum_value
		AND dic.type_value = #{params.checkMode}
		LEFT JOIN (
			SELECT
				ECP.check_id,
				ECP.dept_id deptId,
				GROUP_CONCAT(BDP. NAME) PERSONNAME
			FROM
				ole_ef_check_person ECP,
				OLE_BASE_DEPT_PERSON BDP
			WHERE
				FIND_IN_SET(BDP.ID, ECP.person_id)
			GROUP BY
				CHECK_ID,
				ECP.dept_id
		) CHECK_PERSON ON CK.id = CHECK_PERSON.CHECK_ID
		LEFT JOIN ole_base_dept bd ON bd.id = CHECK_PERSON.deptId
		LEFT JOIN ole_base_area ba ON ba.id = bd.area_id
		LEFT JOIN ole_ef_check_record ecr ON ecr.check_id = ck.id
		LEFT JOIN ole_base_dept_person per1 ON per1.ID = ecr.assist_person_id
		<where>
			1=1
			<if test="params.deptIds != null and params.deptIds != ''">
				and FIND_IN_SET (bd.id ,#{params.deptIds})
			</if>
			<if test="params.areaId != null and params.areaId != ''">
				AND ba.id = #{params.areaId}
			</if>
		</where>
	</select>
	
	<!-- 根据deptId查询日常检查列表-->
	<select id="selectDailyBydeptId" resultType="com.orhonit.ole.enforce.dto.ps.PsCheckDTO">
		SELECT
			ecd.id checkId,
			bd.id deptId,
			bd.name deptName,
			ba.name areaName,
			ecd.person_id AS personId,
			ecd.check_title AS checkTitle, 
			ecd.checked_date AS checkedDate,
			ecd.check_mode AS checkMode,
			ecd.check_mode_id AS checkModeId,
			sd2.enum_desc AS checkObjectType,
			per.name AS personName,
			per1.name AS assistPersonName,
			ecd.check_num AS checkNum,
			sd3.enum_desc AS checkStutas
		FROM
			ole_ef_check_daily ecd
		LEFT JOIN ole_base_dept bd ON ecd.dept_id=bd.id
		LEFT JOIN ole_base_area ba ON ba.id= bd.area_id
		LEFT JOIN ole_base_dept_person per ON per.ID= ecd.person_id
		LEFT JOIN ole_base_dept_person per1 ON per1.ID= ecd.assist_person_id
		LEFT JOIN ole_sys_dict sd2 ON sd2.enum_value = ecd.check_object_type and sd2.type_value = #{checkObjectType}
		LEFT JOIN ole_sys_dict sd3 ON sd3.enum_value = ecd.`status` and sd3.type_value = #{checkStutas}
		<where>
			bd.is_ps="1"
			<if test="deptId != null and deptId != ''">
				AND bd.id = #{deptId}
			</if>	
			<if test="areaId != null and areaId != ''">
				AND ba.id = #{areaId}
			</if>	
		</where>
		order by ecd.create_date desc	 
		LIMIT  #{startIndex},#{pageSize}
	</select>
	
	<!-- 根据checkId查询日常检查详情-->
	<select id="getDailyByCaseId" resultType="com.orhonit.ole.enforce.dto.api.ApiDailyCheckDTO">
		SELECT
		  ECD.ID                AS id,
		  ECD.dept_id           AS deptId,
		  ECD.CHECK_NUM         AS checkNum,
		  ECD.CHECK_TITLE       AS checkTitle,
		  ECD.CHECK_MODE      	AS checkMode,
		  ECD.CHECK_MODE_ID    AS checkModeId,
		  API.NAME              AS sistPersonName,
		  PI.NAME               AS personName,
		  ECD.ROAD_NAME         AS roadName,
		  ECD.CHECKED_DATE      AS checkedDate,
		  SDCS.ENUM_DESC        AS checkStatus,
		  ECD.CHECK_SITUATION   AS checkSituation,
		  ECD.CHECK_OBJECT_TYPE AS checkObjectType,
		  ECD.CHECKED_USER_NAME AS checkedUserName,
		  ECD.CHECKED_USER_ID   AS checkedUserId,
		  ECD.UNIT_NAME         AS unitName,
		  ECD.REGIST_NUM        AS registNum,
		  ECD.LEGAL_PERSON      AS legalPerson,
		  ECD.LNG               AS lng,
		  ECD.LAT               AS lat
		FROM OLE_EF_CHECK_DAILY ECD
		  LEFT JOIN OLE_BASE_DEPT_PERSON API
		    ON API.ID = ECD.ASSIST_PERSON_ID
		  LEFT JOIN OLE_BASE_DEPT_PERSON PI
		    ON PI.ID = ECD.PERSON_ID
		  LEFT JOIN OLE_SYS_DICT SDCS
		    ON SDCS.TYPE_VALUE = '1502'
		      AND SDCS.ENUM_VALUE = ECD.STATUS 
		<where>
			<if test="caseIdMp.checkId != null and caseIdMp.checkId != ''">
				AND ECD.id = #{caseIdMp.checkId}
			</if>
			<if test="caseIdMp.checkNum != null and caseIdMp.checkNum != ''">
				AND ECD.check_num = #{caseIdMp.checkNum}
			</if>	
		</where>
	</select>
	
	<!-- API根据deptId查询日常检查列表-->
	<select id="ApiSelectDailyBydeptId" resultType="com.orhonit.ole.enforce.dto.ps.PsCheckDTO">
		SELECT
			ecd.id checkId,
			bd.id deptId,
			bd.name deptName,
			ba.name areaName,
			ecd.person_id AS personId,
			ecd.check_title AS checkTitle, 
			ecd.checked_date AS checkedDate,
			ecd.check_mode AS checkMode,
			ecd.check_mode_id AS checkModeId,
			sd2.enum_desc AS checkObjectType,
			per.name AS personName,
			per1.name AS assistPersonName,
			ecd.check_num AS checkNum,
			sd3.enum_desc AS checkStutas,
			ecd.road_name AS roadName
		FROM
			ole_ef_check_daily ecd
		LEFT JOIN ole_base_dept bd ON ecd.dept_id=bd.id
		LEFT JOIN ole_base_area ba ON ba.id= bd.area_id
		LEFT JOIN ole_base_dept_person per ON per.ID= ecd.person_id
		LEFT JOIN ole_base_dept_person per1 ON per1.ID= ecd.assist_person_id
		LEFT JOIN ole_sys_dict sd2 ON sd2.enum_value = ecd.check_object_type and sd2.type_value = #{checkObjectType}
		LEFT JOIN ole_sys_dict sd3 ON sd3.enum_value = ecd.status and sd3.type_value = #{checkStutas}
		<where>
			1=1
			<if test="deptId != null and deptId != ''">
				AND bd.id = #{deptId}
			</if>	
			<if test="areaId != null and areaId != ''">
				AND ba.id = #{areaId}
			</if>
			<if test="checkMode != null and checkMode != ''">
				AND ecd.check_mode = #{checkMode}
			</if>
			<if test="checkTitle != 'null' and checkTitle != ''">
				AND ecd.check_title like concat('%', #{checkTitle}, '%')
			</if>
		</where>
		order by ecd.create_date desc	 
		LIMIT  #{startIndex},#{endIndex}
	</select>
	
	<!-- API根据deptId查询日常检查列表-->
	<select id="ApiSelectDailyBydeptIdMap" resultType="com.orhonit.ole.enforce.dto.ps.PsCheckDTO">
		SELECT
			ecd.id checkId,
			bd.id deptId,
			bd.name deptName,
			ba.name areaName,
			ecd.person_id AS personId,
			ecd.check_title AS checkTitle, 
			ecd.checked_date AS checkedDate,
			ecd.check_mode AS checkMode,
			ecd.check_mode_id AS checkModeId,
			sd2.enum_desc AS checkObjectType,
			per.name AS personName,
			per1.name AS assistPersonName,
			ecd.check_num AS checkNum,
			sd3.enum_desc AS checkStutas,
			ecd.road_name AS roadName
		FROM
			ole_ef_check_daily ecd
		LEFT JOIN ole_base_dept bd ON ecd.dept_id=bd.id
		LEFT JOIN ole_base_area ba ON ba.id= bd.area_id
		LEFT JOIN ole_base_dept_person per ON per.ID= ecd.person_id
		LEFT JOIN ole_base_dept_person per1 ON per1.ID= ecd.assist_person_id
		LEFT JOIN ole_sys_dict sd2 ON sd2.enum_value = ecd.check_object_type and sd2.type_value = #{checkObjectType}
		LEFT JOIN ole_sys_dict sd3 ON sd3.enum_value = ecd.`status` and sd3.type_value = #{checkStutas}
		<where>
			1=1
			<!--YEAR(ecd.create_date)=YEAR(NOW())-->
			<if test="deptIds != null and deptIds != ''">
				and FIND_IN_SET (bd.id ,#{deptIds})
			</if>
			<if test="checkMode1 != null and checkMode1 != ''">
				AND ecd.status = #{checkMode1}
			</if>
			<if test="checkTitle != 'null' and checkTitle != ''">
				AND ecd.check_title like concat('%', #{checkTitle}, '%')
			</if>	
			<if test="queryDate != null and queryDate != '' and queryDate == 1 ">
				AND  date(ecd.create_date) = curdate()
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ecd.create_date)		
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ecd.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ecd.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 5 ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ecd.create_date)	
			</if>
		</where>
		order by ecd.create_date desc	
		<if test="params.currentPage != null and params.pageSize != ''">
			limit #{params.currentPage}, #{params.pageSize};
		</if>
	</select>
	
	<!-- API根据deptId查询日常检查列表-->
	<select id="ApiDailyNumMap" resultType="INTEGER">
		SELECT count(ecd.id)
		FROM
			ole_ef_check_daily ecd
		LEFT JOIN ole_base_dept bd ON ecd.dept_id=bd.id
		LEFT JOIN ole_base_area ba ON ba.id= bd.area_id
		LEFT JOIN ole_base_dept_person per ON per.ID= ecd.person_id
		LEFT JOIN ole_base_dept_person per1 ON per1.ID= ecd.assist_person_id
		LEFT JOIN ole_sys_dict sd2 ON sd2.enum_value = ecd.check_object_type and sd2.type_value = #{checkObjectType}
		LEFT JOIN ole_sys_dict sd3 ON sd3.enum_value = ecd.`status` and sd3.type_value = #{checkStutas}
		<where>
			1=1
			<!--YEAR(ecd.create_date)=YEAR(NOW())-->
			<if test="deptIds != null and deptIds != ''">
				and FIND_IN_SET (bd.id ,#{deptIds})
			</if>
			<if test="checkMode1 != null and checkMode1 != ''">
				AND ecd.status = #{checkMode1}
			</if>
			<if test="checkTitle != 'null' and checkTitle != ''">
				AND ecd.check_title like concat('%', #{checkTitle}, '%')
			</if>	
			<if test="queryDate != null and queryDate != '' and queryDate == 1 ">
				AND  date(ecd.create_date) = curdate()
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ecd.create_date)		
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ecd.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ecd.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 5 ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ecd.create_date)	
			</if>
		</where>
	</select>
	
	<!-- 根据deptId查询专项检查列表-->
	<select id="selectSpecialBydeptId" resultType="com.orhonit.ole.enforce.dto.ps.PsCheckDTO">
		SELECT
			ck.id AS id,
			ck.check_title AS checkTitle,
			ck.check_object AS checkObjeck,
			dic.enum_desc AS checkStutas,
			ck.start_date AS startDate,
			ck.end_date AS endDate,
			ck.check_num AS checkNum,
			ck.check_basis AS checkBasis,
			ck.check_content AS checkContent,
			ck.check_way AS checkWay,
			ck.create_by AS createBy,
			ck.create_name AS createName,
			CHECK_PERSON.deptId AS deptId,
			bd.NAME AS deptName,
			ba.name AS areaName,
			CHECK_PERSON.PERSONNAME AS personName,
			per1.name AS assistPersonName,
			rd.road_name AS roadName
		FROM
			ole_ef_check ck
		LEFT JOIN ole_sys_dict dic ON ck. STATUS = dic.enum_value
		AND dic.type_value = '1501'
		LEFT JOIN (
			SELECT
				ECP.check_id,
				ECP.dept_id deptId,
				GROUP_CONCAT(BDP. NAME) PERSONNAME
			FROM
				ole_ef_check_person ECP,
				OLE_BASE_DEPT_PERSON BDP
			WHERE
				FIND_IN_SET(BDP.ID, ECP.person_id)
			GROUP BY
				CHECK_ID,
				ECP.dept_id
		) CHECK_PERSON ON CK.id = CHECK_PERSON.CHECK_ID
		LEFT JOIN ole_base_dept bd ON bd.id = CHECK_PERSON.deptId
		LEFT JOIN ole_base_area ba ON ba.id= bd.area_id
		LEFT JOIN ole_ef_check_record rd ON ck.id=rd.check_id
		LEFT JOIN ole_base_dept_person per1 ON per1.ID= rd.assist_person_id,
		
		<where>
			<if test="deptId != null and deptId != ''">
				AND bd.id = #{deptId}
			</if>
			<if test="areaId != null and areaId != ''">
				AND ba.id = #{areaId}
			</if>
			<if test="checkTitle != null and checkTitle != ''">
				AND ck.check_title like concat('%', #{checkTitle}, '%')
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 1 ">
				AND  date(ck.create_date) = curdate()
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ck.create_date)		
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ck.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ck.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 5 ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ck.create_date)	
			</if>
		</where>
		order by ck.create_date desc	 
		LIMIT  #{startIndex},#{pageSize}
	</select>
	
	<!-- 根据checkId查询专项检查详情-->
	<select id="getSpecialByCaseId" resultType="com.orhonit.ole.enforce.dto.LssuedDetailInfoDTO">
		SELECT 
			ck.id AS id,
			ck.check_title AS checkTitle,
			ck.check_object AS checkObject,
			ck.start_date AS startDate,
			ck.end_date AS endDate,
			dic.enum_desc AS 'status',
			ck.check_basis AS checkBasis,
			ck.check_content AS checkContent,
			ck.check_way AS checkWay,
			ck.create_by AS createBy,
			ck.create_name AS createName,
			pn.dept_id AS deptId,
			pn.person_id AS personId,
			per.name AS personName,
			dt.name AS deptName,
			ck.check_num AS checkNum,
			rd.id AS recordId,
			rd.assist_person_id  AS assistPersonId,
			per1.name AS assistPersonName,
			rd.check_mode AS checkMode,
			rd.check_mode_id AS checkModeId,
			rd.check_object_type AS checkObjectType,
			rd.checked_user_name AS checkedUserName,
			rd.checked_user_id AS checkedUserId, 
			rd.checked_date AS checkedDate,
			rd.road_name AS roadName, 
			rd.check_situation AS checkSituation,
			rd.checked_date as checkDate,
			rd.unit_name AS unitName, 
			rd.regist_num AS registNum,
			rd.legal_person AS legalPerson,
			rd.lng as lng,
			rd.lat as lat
		FROM ole_ef_check ck
		LEFT JOIN ole_ef_check_person pn ON pn.check_id=ck.id		
		LEFT JOIN ole_base_dept_person per ON per.ID= pn.person_id
		LEFT JOIN ole_base_dept dt ON dt.id= pn.dept_id
		LEFT JOIN ole_sys_dict dic ON ck.status=dic.enum_value AND dic.type_value='1501'
		LEFT JOIN ole_ef_check_record rd ON ck.id=rd.check_id
		LEFT JOIN ole_base_dept_person per1 ON per1.ID= rd.assist_person_id
		<where>
			1=1
			<if test="caseIdMp.checkId != null and caseIdMp.checkId != ''">
				AND ck.id = #{caseIdMp.checkId}
			</if>
			<if test="caseIdMp.checkNum != null and caseIdMp.checkNum != ''">
				AND ck.check_num = #{caseIdMp.checkNum}
			</if>
		</where>
	</select>
	
	<!-- API根据deptId查询专项检查列表-->
	<select id="ApiSelectSpecialBydeptId" resultType="com.orhonit.ole.enforce.dto.ps.PsCheckDTO">
		SELECT
			ck.id AS checkId,
			ck.check_title AS checkTitle,
			ck.check_object AS checkObjeck,
			dic.enum_desc AS checkStutas,
			ck.start_date AS startDate,
			ck.end_date AS endDate,
			ck.check_num AS checkNum,
			ck.check_basis AS checkBasis,
			ck.check_content AS checkContent,
			ck.check_way AS checkWay,
			ck.create_by AS createBy,
			ck.create_name AS createName,
			CHECK_PERSON.deptId AS deptId,
			bd.NAME AS deptName,
			ba.name AS areaName,
			CHECK_PERSON.PERSONNAME AS personName,
			ecr.road_name AS roadName,
			per1.name AS assistPersonName
		FROM
			ole_ef_check ck
		LEFT JOIN ole_sys_dict dic ON ck.STATUS = dic.enum_value AND dic.type_value = '1501'
		LEFT JOIN (
			SELECT
				ECP.check_id,
				ECP.dept_id deptId,
				GROUP_CONCAT(BDP. NAME) PERSONNAME
			FROM
				ole_ef_check_person ECP,
				OLE_BASE_DEPT_PERSON BDP
			WHERE
				FIND_IN_SET(BDP.ID, ECP.person_id)
			GROUP BY
				CHECK_ID,
				ECP.dept_id
		) CHECK_PERSON ON CK.id = CHECK_PERSON.CHECK_ID
		LEFT JOIN ole_base_dept bd ON bd.id = CHECK_PERSON.deptId
		LEFT JOIN ole_base_area ba ON ba.id = bd.area_id
		LEFT JOIN ole_ef_check_record ecr ON ecr.check_id = ck.id
		LEFT JOIN ole_base_dept_person per1 ON per1.ID = ecr.assist_person_id
		<where>
			<if test="deptId != null and deptId != ''">
				AND bd.id = #{deptId}
			</if>
			<if test="areaId != null and areaId != ''">
				AND ba.id = #{areaId}
			</if>
			<if test="checkMode != null and checkMode != ''">
				AND ck.status = #{checkMode}
			</if>
			<if test="checkTitle != 'null' and checkTitle != ''">
				AND ck.check_title like concat('%', #{checkTitle}, '%')
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 1 ">
				AND  date(ck.create_date) = curdate()
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ck.create_date)		
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ck.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ck.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 5 ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ck.create_date)	
			</if>
		</where>
		order by ck.create_date desc	 
		LIMIT  #{startIndex},#{endIndex}
	</select>
	
	<!-- API根据deptId查询专项检查列表-->
	<select id="ApiSelectSpecialBydeptIdMap" resultType="com.orhonit.ole.enforce.dto.ps.PsCheckDTO">
		SELECT
			ck.id AS checkId,
			ck.check_title AS checkTitle,
			ck.check_object AS checkObjeck,
			dic.enum_desc AS checkMode,
			ck.status AS checkStatus,
			ck.start_date AS startDate,
			ck.end_date AS endDate,
			ck.check_num AS checkNum,
			ck.check_basis AS checkBasis,
			ck.check_content AS checkContent,
			ck.check_way AS checkWay,
			ck.create_by AS createBy,
			ck.create_name AS createName,
			CHECK_PERSON.deptId AS deptId,
			bd.NAME AS deptName,
			ba.name AS areaName,
			CHECK_PERSON.PERSONNAME AS personName,
			ecr.road_name AS roadName,
			per1.name AS assistPersonName
		FROM
			ole_ef_check ck
		LEFT JOIN ole_sys_dict dic ON ck. STATUS = dic.enum_value
		AND dic.type_value = #{checkStatus}
		LEFT JOIN (
			SELECT
				ECP.check_id,
				ECP.dept_id deptId,
				GROUP_CONCAT(BDP. NAME) PERSONNAME
			FROM
				ole_ef_check_person ECP,
				OLE_BASE_DEPT_PERSON BDP
			WHERE
				FIND_IN_SET(BDP.ID, ECP.person_id)
			GROUP BY
				CHECK_ID,
				ECP.dept_id
		) CHECK_PERSON ON CK.id = CHECK_PERSON.CHECK_ID
		LEFT JOIN ole_base_dept bd ON bd.id = CHECK_PERSON.deptId
		LEFT JOIN ole_base_area ba ON ba.id = bd.area_id
		LEFT JOIN ole_ef_check_record ecr ON ecr.check_id = ck.id
		LEFT JOIN ole_base_dept_person per1 ON per1.ID = ecr.assist_person_id
		<where>
			1=1
			<!--YEAR(ck.create_date)=YEAR(NOW())-->
			<if test="deptIds != null and deptIds != ''">
				and FIND_IN_SET (bd.id ,#{deptIds})
			</if>
			<if test="checkMode != null and checkMode != ''">
				AND ck.status = #{checkMode}
			</if>
			<if test="checkTitle != 'null' and checkTitle != ''">
				AND ck.check_title like concat('%', #{checkTitle}, '%')
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 1 ">
				AND  date(ck.create_date) = curdate()
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ck.create_date)		
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ck.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ck.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 5 ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ck.create_date)	
			</if>
		</where>
		order by ck.create_date desc	 
		<!-- <if test="params.start != null and params.length != ''">
			limit #{params.start}, #{params.length};
		</if> -->
		<if test="params.currentPage != null and params.pageSize != ''">
			limit #{params.currentPage}, #{params.pageSize};
		</if>
	</select>
	
	<!-- API根据deptId查询专项检查列表-->
	<select id="ApiSpecialNumMap" resultType="INTEGER">
		SELECT count(ck.id)
		FROM
			ole_ef_check ck
		LEFT JOIN ole_sys_dict dic ON ck. STATUS = dic.enum_value
		AND dic.type_value = #{checkStatus}
		LEFT JOIN (
			SELECT
				ECP.check_id,
				ECP.dept_id deptId,
				GROUP_CONCAT(BDP. NAME) PERSONNAME
			FROM
				ole_ef_check_person ECP,
				OLE_BASE_DEPT_PERSON BDP
			WHERE
				FIND_IN_SET(BDP.ID, ECP.person_id)
			GROUP BY
				CHECK_ID,
				ECP.dept_id
		) CHECK_PERSON ON CK.id = CHECK_PERSON.CHECK_ID
		LEFT JOIN ole_base_dept bd ON bd.id = CHECK_PERSON.deptId
		LEFT JOIN ole_base_area ba ON ba.id = bd.area_id
		LEFT JOIN ole_ef_check_record ecr ON ecr.check_id = ck.id
		LEFT JOIN ole_base_dept_person per1 ON per1.ID = ecr.assist_person_id
		<where>
			1=1
			<!--YEAR(ck.create_date)=YEAR(NOW())-->
			<if test="deptIds != null and deptIds != ''">
				and FIND_IN_SET (bd.id ,#{deptIds})
			</if>
			<if test="checkMode != null and checkMode != ''">
				AND ck.status = #{checkMode}
			</if>
			<if test="checkTitle != 'null' and checkTitle != ''">
				AND ck.check_title like concat('%', #{checkTitle}, '%')
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 1 ">
				AND  date(ck.create_date) = curdate()
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ck.create_date)		
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ck.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ck.create_date)			
			</if>
			<if test="queryDate != null and queryDate != '' and queryDate == 5 ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ck.create_date)	
			</if>
		</where>
	</select>
	
	<!-- 查询各部门专项检查统计-->
	<select id="selectSpecialCaseList" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			COUNT(ecd.id) caseNum,
			bd.id deptId,
			bd.name deptName
		FROM
		   ole_base_dept bd
		LEFT JOIN ole_ef_check_person bdp ON bdp.dept_id= bd.id
		LEFT JOIN ole_ef_check ecd ON ecd.id=bdp.check_id
		<where>
			 bd.is_ps="1"
			 <if test="params.deptName != null and params.deptName != ''">
				and bd.name like concat('%', #{params.deptName}, '%')
			</if>
		</where>
		GROUP BY
			bd.id
	</select>
	
	<!-- ps根据案件Id查询案件详情-->
	<select id="psCase" resultType="com.orhonit.ole.enforce.dto.ps.PsCaseDTO">
		SELECT
			ec.id caseId,
			ec.case_name caseName, 
			ec.case_num caseNum, 
			sd.enum_desc caseSource,
			ec.case_address caseAddress,
			ec.case_apply_date caseApplyDate,
			ec.brief_case_content briefCaseContent,
			ec.case_handler caseHandler,
			osu.nickname caseZpr,
			ec.case_zzfryname caseZzfryname,
			ec.case_fzfryname caseFzfryname,
			sd1.enum_desc caseType,
			ec.case_zpdate caseZpdate,
			sd2.enum_desc caseStatus,
			ec.case_apply_date caseApplyDate,
			epi.unit_name unitName,
			epi.org_code orgCode,
			epi.legal_name legelName,
			epi.org_id_card orgIdCard			
		FROM
			ole_ef_case ec
		LEFT JOIN
			ole_ef_party_info epi on epi.case_id=ec.id
		LEFT JOIN
			ole_sys_dict sd ON sd.enum_value=ec.case_source and sd.type_value='1002'
		LEFT JOIN
			ole_sys_dict sd1 ON sd1.enum_value=ec.case_type and sd1.type_value='1003'
		LEFT JOIN
			ole_sys_dict sd2 ON sd2.enum_value=ec.case_status and sd2.type_value='1500'
		LEFT JOIN
			ole_sys_user osu ON ec.case_zpr=osu.id
		<where>
			<if test="params.caseId != null and params.caseId != ''">
				ec.id = #{params.caseId}
			</if>
		</where>	
	</select>
	
	<!-- 监督案件列表查询-->
	<select id="caseQuery" resultType="com.orhonit.ole.enforce.dto.CaseListDTO">
		
		SELECT  ec.id as id,
			ec.case_name AS caseName, 
			ec.case_num AS caseNum, 
			sd.enum_desc AS caseSource,
			bd.name AS deptName,
			ec.case_address caseAddress,
			ec.case_zzfryname As casezzfryName,
			ec.case_time AS caseTime,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpDate,
			ec.case_handler AS caseHandler,
			ec.case_zzfryname AS zzfryName,
			ec.case_fzfryname AS fzfryName,
			ec.case_zpr AS zprId,
			sd1.enum_desc AS caseStatus,
			sd2.enum_desc AS flowType
			FROM ole_ef_case ec 
			LEFT JOIN ole_sys_dict sd2 ON sd2.enum_value = ec.flow_type AND sd2.type_value = '1802' 
			LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ec.case_status AND sd1.type_value = '1500' 
			LEFT JOIN ole_sys_dict sd ON sd.enum_value = ec.case_source AND sd.type_value = #{params.typeValue}		
			LEFT JOIN ole_base_dept bd ON bd.id = ec.dept_id
		<where>
		    1=1
			<if test="params.deptIds != null and params.deptIds != ''">
				and FIND_IN_SET (ec.dept_id ,#{params.deptIds})
			</if>
			<if test="params.deptId != null and params.deptId != ''">
				and ec.dept_id = #{params.deptId} 
			</if>
			<if test="params.id != null and params.id != ''">
				and ec.case_num like concat('%', #{params.id}, '%')
			</if>
			<if test="params.caseName != null and params.caseName != ''">
				and ec.case_name like concat('%', #{params.caseName}, '%')
			</if>
			<if test="params.zzfryName != null and params.zzfryName != ''">
				and ec.case_zzfryname like concat('%', #{params.zzfryName}, '%')
			</if>
			<if test="params.caseTime != null and params.caseTime != ''">
				and DATEDIFF(DATE_FORMAT(ec.case_time,'%Y-%m-%d'),#{params.caseTime})=0
			</if>
			<if test="params.caseStatus != null and params.caseStatus != ''">
				and ec.case_status = #{params.caseStatus} 
			</if>
			<if test="params.flowType != null">
				and ec.flow_type = #{params.flowType} 
			</if>
			<if test="params.zzfryId != null">
				and ec.case_zzfryid = #{params.zzfryId} 
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 1 ">
				AND  date(ec.create_date) = curdate()
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ec.create_date)		
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 5  ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ec.create_date)	
			</if>
			order by ec.create_date desc
			<if test="start != null and length != ''">
				limit #{start}, #{length};
			</if>
       </where> 
        
	</select>
	
	<!-- 监督案件列表查询-->
	<select id="caseQueryApp" resultType="com.orhonit.ole.enforce.dto.CaseListDTO">
		
		SELECT  ec.id as id,
			ec.case_name AS caseName, 
			ec.case_num AS caseNum, 
			sd.enum_desc AS caseSource,
			bd.name AS deptName,
			ec.case_address caseAddress,
			ec.case_zzfryname As casezzfryName,
			ec.case_time AS caseTime,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpDate,
			ec.case_handler AS caseHandler,
			ec.case_zzfryname AS zzfryName,
			ec.case_fzfryname AS fzfryName,
			ec.case_zpr AS zprId,
			sd1.enum_desc AS caseStatus,
			sd2.enum_desc AS flowType
			FROM ole_ef_case ec 
			LEFT JOIN ole_sys_dict sd2 ON sd2.enum_value = ec.flow_type AND sd2.type_value = '1802' 
			LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ec.case_status AND sd1.type_value = '1500' 
			LEFT JOIN ole_sys_dict sd ON sd.enum_value = ec.case_source AND sd.type_value = #{params.typeValue}		
			LEFT JOIN ole_base_dept bd ON bd.id = ec.dept_id
		<where>
		    1=1
			<if test="params.deptIds != null and params.deptIds != ''">
				and FIND_IN_SET (ec.dept_id ,#{params.deptIds})
			</if>
			<!--<if test="params.deptId != null and params.deptId != ''">
				and ec.dept_id = #{params.deptId} 
			</if>-->
			<if test="params.id != null and params.id != ''">
				and ec.case_num like concat('%', #{params.id}, '%')
			</if>
			<if test="params.caseName != null and params.caseName != ''">
				and ec.case_name like concat('%', #{params.caseName}, '%')
			</if>
			<if test="params.zzfryName != null and params.zzfryName != ''">
				and ec.case_zzfryname like concat('%', #{params.zzfryName}, '%')
			</if>
			<if test="params.caseTime != null and params.caseTime != ''">
				and DATEDIFF(DATE_FORMAT(ec.case_time,'%Y-%m-%d'),#{params.caseTime})=0
			</if>
			<if test="params.caseStatus != null and params.caseStatus != ''">
				and ec.case_status = #{params.caseStatus} 
			</if>
			<if test="params.flowType != null">
				and ec.flow_type = #{params.flowType} 
			</if>
			<if test="params.zzfryId != null">
				and ec.case_zzfryid = #{params.zzfryId} 
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 1 ">
				AND  date(ec.create_date) = curdate()
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ec.create_date)		
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 5  ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ec.create_date)	
			</if>
			order by ec.create_date desc
			<if test="params.currentPage != null and params.pageSize != ''">
				limit #{params.currentPage}, #{params.pageSize};
			</if>
       </where> 
        
	</select>
	
	<!-- 监督案件列表查询总数-->
	<select id="caseQuerycount" resultType="int">
	SELECT  count(*)FROM ole_ef_case ec 
				LEFT JOIN ole_sys_dict sd ON sd.enum_value = ec.case_source AND sd.type_value = #{params.typeValue}
		 
		<where>
			1=1
			<if test="params.deptIds != null and params.deptIds != ''">
				and FIND_IN_SET (ec.dept_id ,#{params.deptIds})
			</if>
			<if test="params.deptId != null and params.deptId != ''">
				and ec.dept_id = #{params.deptId} 
			</if>
			<if test="params.id != null and params.id != ''">
				and ec.case_num like concat('%', #{params.id}, '%')
			</if>
			<if test="params.caseName != null and params.caseName != ''">
				and ec.case_name like concat('%', #{params.caseName}, '%')
			</if>
			<if test="params.zzfryName != null and params.zzfryName != ''">
				and ec.case_zzfryname like concat('%', #{params.zzfryName}, '%')
			</if>
			<if test="params.caseTime != null and params.caseTime != ''">
				and DATEDIFF(DATE_FORMAT(ec.case_time,'%Y-%m-%d'),#{params.caseTime})=0
			</if>
			<if test="params.caseStatus != null and params.caseStatus != ''">
				and ec.case_status = #{params.caseStatus} 
			</if>
			<if test="params.flowType != null">
				and ec.flow_type = #{params.flowType} 
			</if>
			<if test="params.zzfryId != null">
				and ec.case_zzfryid = #{params.zzfryId} 
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 1 ">
				AND  date(ec.create_date) = curdate()
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ec.create_date)		
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 5  ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ec.create_date)	
			</if>
		</where>
		;	
	</select>
	
	<!-- 监督案件列表查询总数-->
	<select id="caseQuerycountApp" resultType="int">
	SELECT  count(*)FROM ole_ef_case ec 
				LEFT JOIN ole_sys_dict sd ON sd.enum_value = ec.case_source AND sd.type_value = #{params.typeValue}
		 
		<where>
			1=1
			<if test="params.deptIds != null and params.deptIds != ''">
				and FIND_IN_SET (ec.dept_id ,#{params.deptIds})
			</if>
			<!--<if test="params.deptId != null and params.deptId != ''">
				and ec.dept_id = #{params.deptId} 
			</if>-->
			<if test="params.id != null and params.id != ''">
				and ec.case_num like concat('%', #{params.id}, '%')
			</if>
			<if test="params.caseName != null and params.caseName != ''">
				and ec.case_name like concat('%', #{params.caseName}, '%')
			</if>
			<if test="params.zzfryName != null and params.zzfryName != ''">
				and ec.case_zzfryname like concat('%', #{params.zzfryName}, '%')
			</if>
			<if test="params.caseTime != null and params.caseTime != ''">
				and DATEDIFF(DATE_FORMAT(ec.case_time,'%Y-%m-%d'),#{params.caseTime})=0
			</if>
			<if test="params.caseStatus != null and params.caseStatus != ''">
				and ec.case_status = #{params.caseStatus} 
			</if>
			<if test="params.flowType != null">
				and ec.flow_type = #{params.flowType} 
			</if>
			<if test="params.zzfryId != null">
				and ec.case_zzfryid = #{params.zzfryId} 
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 1 ">
				AND  date(ec.create_date) = curdate()
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 2 ">
				AND  date_sub(curdate(), INTERVAL 7 DAY) &lt;= date(ec.create_date)		
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 3 ">
				AND  date_sub(curdate(), INTERVAL 30 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 4 ">
				AND  date_sub(curdate(), INTERVAL 180 DAY) &lt;= date(ec.create_date)			
			</if>
			<if test="params.queryDate != null and params.queryDate != '' and params.queryDate == 5  ">
				AND  date_sub(curdate(), INTERVAL 365 DAY) &lt;= date(ec.create_date)	
			</if>
		</where>
		;	
	</select>
	
	<!-- app 领导案件统计 -->
	<select id="getLeaderCaseCount" resultType="int">
		SELECT
			COUNT(*)
		FROM
			act_ru_execution re,
			act_ru_task rt
		WHERE
			re.PROC_INST_ID_ = rt.PROC_INST_ID_
		AND rt.ASSIGNEE_ =  #{personAppDTO.userId}
		AND rt.NAME_ like concat('%', #{caseStatusList}, '%')
	</select>

	<!--app 我的审核-->
	<select id="getLeaderApprove" resultType="com.orhonit.ole.enforce.dto.CaseListDTO">
	SELECT  ec.id as id,
			ec.case_name AS caseName, 
			ec.case_num AS caseNum, 
			sd.enum_desc AS caseSource,
			ec.case_address caseAddress,
			ec.case_zzfryname As casezzfryName,
			ec.case_time AS caseTime,
			ec.case_apply_date caseApplyDate,
			ec.case_zpdate caseZpDate,
			ec.case_handler AS caseHandler,
			ec.case_zzfryname AS zzfryName,
			ec.case_zpr AS zprId,
			sd1.enum_desc AS caseStatus
			FROM ole_ef_case ec 
			LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ec.case_status AND sd1.type_value = '1500' 
			LEFT JOIN ole_sys_dict sd ON sd.enum_value = ec.case_source AND sd.type_value = '1002'
			where case_num in (
		SELECT BUSINESS_KEY_ AS businessKey
		FROM
			act_ru_execution re,
			act_ru_task rt
 		WHERE
 			re.PROC_INST_ID_ = rt.PROC_INST_ID_
 			AND rt.ASSIGNEE_ = #{personAppDTO.userId} AND
 			re.BUSINESS_KEY_ IN (
				SELECT case_num FROM ole_ef_case WHERE dept_id = #{personAppDTO.deptId} and case_status IN
		<foreach collection="caseStatusList" item="caseStatus" open="(" separator="," close=")">
			#{caseStatus}
		</foreach>
        ))
        	<if test="caseName != null and caseName != ''">
				and ec.case_name like concat('%', #{caseName}, '%')
			</if>
        limit #{start}, #{length};
	</select>
	
	<select id="getByCaseId" resultType="com.orhonit.ole.enforce.dto.DeptPersonDTO">
		SELECT ser.id AS id,ser.nickname AS NAME,ser.person_id AS personId,ser.dept_id AS deptId
		FROM ole_sys_user ser
		WHERE ser.person_id =( 
		SELECT ce.case_zzfryid FROM ole_ef_case ce WHERE ce.case_num=#{id}
		)
	</select>
	
	<select id="execFunction" resultType="java.lang.String">
		SELECT superviseGetBaseDeptByParentId(#{deptId})
	</select>
	
	<select id="getHaveRoleOpinionByDeptId" resultType="com.orhonit.ole.enforce.dto.NextOpinionDTO">
		SELECT 
			su.id AS userId, 
			su.username AS userName, 
			su.nickname AS nickName 
		FROM ole_sys_user su 
		WHERE su.dept_id = #{deptId} 
		<if test="roleId != null">
			AND su.id  IN ( SELECT sru.userId FROM ole_sys_role_user sru WHERE sru.roleId = #{roleId}  )
		</if>
			
	</select>
	
	<select id="login" resultType="com.orhonit.ole.enforce.dto.ps.LoginUserDTO">
		SELECT
			epl.login_name userName,
			epl.login_password passward,
			epl.person_type personType,
			epi.name name
		FROM
			ole_ef_party_login epl,
			ole_ef_party_info epi
		<where>
			epl.login_name =  #{userName}
			<if test="idCord != null and idCord != ''">
				AND epi.id_card = #{idCord}
			</if>
			<if test="orgCode != null and orgCode != ''">
				AND epi.org_code = #{orgCode}
			</if>
		</where>
		LIMIT 1
			 
	</select>
	
	<select id="getListCssb" resultType="com.orhonit.ole.enforce.dto.CaseListDTO">
		SELECT 
			osu.id as userId,
			osu.username as userNum,
			epi.id as epiId,
			epi.name as userName,
			ef.id as id,
			ef.case_num as caseNum,
			ef.case_name AS caseName, 
			ef.case_address caseAddress,
			ef.case_zzfryname As zzfryName,
			ef.case_time AS caseTime
		FROM ole_ef_case ef 
		LEFT JOIN ole_ef_party_info epi ON epi.case_id=ef.id
		LEFT JOIN ole_sys_user osu ON osu.person_id=ef.case_zzfryid
		LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ef.case_status AND sd1.type_value = '1500' 
		WHERE 
			ef.case_status='57'
			AND epi.id_card=#{params.userName} 
	</select>
	
	<select id="getListCssbGs" resultType="com.orhonit.ole.enforce.dto.CaseListDTO">
		SELECT 
			osu.id as userId,
			osu.username as userNum,
			epi.id as epiId,
			epi.name as userName,
			ef.id as id,
			ef.case_num as caseNum,
			ef.case_name AS caseName, 
			ef.case_address caseAddress,
			ef.case_zzfryname As zzfryName,
			ef.case_time AS caseTime
		FROM ole_ef_case ef 
		LEFT JOIN ole_ef_party_info epi ON epi.case_id=ef.id
		LEFT JOIN ole_sys_user osu ON osu.person_id=ef.case_zzfryid
		LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ef.case_status AND sd1.type_value = '1500' 
		WHERE 
			ef.case_status='57'
			AND epi.org_code=#{params.userName} 
	</select>
	
	<select id="getListSqfy" resultType="com.orhonit.ole.enforce.dto.CaseListDTO">
		SELECT 
			osu.id as userId,
			epi.id as epiId,
			osu.username as userNum,
			epi.name as userName,
			ef.id as id,
			ef.case_num as caseNum,
			ef.case_name AS caseName, 
			ef.case_address caseAddress,
			ef.case_zzfryname As zzfryName,
			ef.case_time AS caseTime,
			ef.dept_id as deptId
		FROM ole_ef_case ef 
		LEFT JOIN ole_ef_party_info epi ON epi.case_id=ef.id
		LEFT JOIN ole_sys_user osu ON osu.person_id=ef.case_zzfryid
		LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ef.case_status AND sd1.type_value = '1500' 
		WHERE 
			ef.case_status='42'
			AND epi.id_card=#{params.userName} 
	</select>
	
	<select id="getListSqfyGs" resultType="com.orhonit.ole.enforce.dto.CaseListDTO">
		SELECT 
			osu.id as userId,
			epi.id as epiId,
			osu.username as userNum,
			epi.name as userName,
			ef.id as id,
			ef.case_num as caseNum,
			ef.case_name AS caseName, 
			ef.case_address caseAddress,
			ef.case_zzfryname As zzfryName,
			ef.case_time AS caseTime,
			ef.dept_id as deptId
		FROM ole_ef_case ef 
		LEFT JOIN ole_ef_party_info epi ON epi.case_id=ef.id
		LEFT JOIN ole_sys_user osu ON osu.person_id=ef.case_zzfryid
		LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ef.case_status AND sd1.type_value = '1500' 
		WHERE 
			ef.case_status='42'
			AND epi.org_code=#{params.userName} 
	</select>
	
	<select id="getListSqtz" resultType="com.orhonit.ole.enforce.dto.CaseListDTO">
		SELECT 
			osu.id as userId,
			epi.id as epiId,
			osu.username as userNum,
			epi.name as userName,
			ef.id as id,
			ef.case_num as caseNum,
			ef.case_name AS caseName, 
			ef.case_address caseAddress,
			ef.case_zzfryname As zzfryName,
			ef.case_time AS caseTime,
			ef.dept_id AS deptId
		FROM ole_ef_case ef 
		LEFT JOIN ole_ef_party_info epi ON epi.case_id=ef.id
		LEFT JOIN ole_sys_user osu ON osu.person_id=ef.case_zzfryid
		LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ef.case_status AND sd1.type_value = '1500' 
		WHERE 
			ef.case_status='26'
			AND epi.id_card=#{params.userName} 
	</select>
	
	<select id="getListSqtzGs" resultType="com.orhonit.ole.enforce.dto.CaseListDTO">
		SELECT 
			osu.id as userId,
			epi.id as epiId,
			osu.username as userNum,
			epi.name as userName,
			ef.id as id,
			ef.case_num as caseNum,
			ef.case_name AS caseName, 
			ef.case_address caseAddress,
			ef.case_zzfryname As zzfryName,
			ef.case_time AS caseTime,
			ef.dept_id AS deptId
		FROM ole_ef_case ef 
		LEFT JOIN ole_ef_party_info epi ON epi.case_id=ef.id
		LEFT JOIN ole_sys_user osu ON osu.person_id=ef.case_zzfryid
		LEFT JOIN ole_sys_dict sd1 ON sd1.enum_value = ef.case_status AND sd1.type_value = '1500' 
		WHERE 
			ef.case_status='26'
			AND epi.org_code=#{params.userName} 
	</select>
	
	<select id="getCaseCountAreaByStatus" resultType="java.util.HashMap">
		SELECT 
			oba.name AS name,
			COUNT(oba.id) AS value 
		FROM ole_base_area oba 
		LEFT JOIN ole_base_dept obd ON obd.area_id = oba.id
		LEFT JOIN ole_ef_case oec ON oec.dept_id = obd.id
		<if test="params.status != null and params.status != '90'">
			LEFT JOIN ole_ef_case_deal oecb ON oec.id = oecb.case_id
		</if>
		WHERE oba.del_flag = '0' AND oba.is_effect = '1' AND oba.parent_id !='0' 
		<if test="params.status != null and params.status != '90'">
			AND oecb.case_status = #{params.status}
		</if>
		<if test="params.status != null and params.status == '90'">
			AND oec.case_status = #{params.status}
		</if>
		GROUP BY oba.id
	</select>
	
	<select id="getWarnCountForArea" resultType="java.util.HashMap">
		SELECT 
			oba.name AS name,
			COUNT(DISTINCT owi.warn_id) AS value 
		FROM ole_base_area oba 
		LEFT JOIN ole_base_dept obd ON obd.area_id = oba.id
		LEFT JOIN ole_warn_person owi ON owi.dept_id = obd.id
		WHERE oba.del_flag = '0' AND oba.is_effect = '1' AND oba.parent_id !='0' 
		GROUP BY oba.id
	</select>
	
	<select id="getCheckDailyCountForArea" resultType="java.util.HashMap">
		SELECT 
			oba.name AS name,
			COUNT(oba.id) AS value 
		FROM ole_base_area oba 
		LEFT JOIN ole_base_dept obd ON obd.area_id = oba.id
		LEFT JOIN ole_ef_check_daily oecd ON oecd.dept_id = obd.id
		WHERE oba.del_flag = '0' AND oba.is_effect = '1' AND oba.parent_id !='0' 
		GROUP BY oba.id 
	</select>
	
	<select id="getCheckCountForArea" resultType="java.util.HashMap">
		SELECT 
			oba.name AS name,
			COUNT(oba.id) AS value 
		FROM ole_base_area oba 
		LEFT JOIN ole_base_dept obd ON obd.area_id = oba.id
		LEFT JOIN ole_ef_check_person oecp ON oecp.dept_id = obd.id
		WHERE oba.del_flag = '0' AND oba.is_effect = '1' AND oba.parent_id !='0' 
		GROUP BY oba.id 
	</select>
	
	<select id="getCaseCountByStatus" resultType="java.lang.String">
		SELECT COUNT(*) AS value FROM ole_ef_case oec
		<where>
			<if test="caseStatus != null and caseStatus != ''">
				AND oec.case_status =#{caseStatus}
			</if>
			<if test="lx_type != null and lx_type == '1'">
				oec.dept_id in ( select id from ole_base_dept where area_id = #{aeraId})
			</if>
			<if test="lx_type != null and lx_type == '2'">
				oec.dept_id in (#{deptIds})
			</if>
		</where>
	</select>
	
	<select id="getCaseCountByDeal" resultType="java.lang.String">
		SELECT count(*) FROM ole_ef_case_deal oecb
		LEFT JOIN ole_ef_case oec ON oec.id = oecb.case_id
		<where>
			<if test="dealMode != null and dealMode != ''">
				AND oecb.deal_mode =#{dealMode}
			</if>
			<if test="lx_type != null and lx_type == '1'">
				oec.dept_id in ( select id from ole_base_dept where area_id = #{aeraId})
			</if>
			<if test="lx_type != null and lx_type == '2'">
				oec.dept_id in (#{deptIds})
			</if>
		</where>
	</select>
	
	<select id="getCheckDailyCountByDeptId" resultType="java.lang.String">
		SELECT COUNT(*) FROM ole_ef_check_daily
		<where>
			<if test="lx_type != null and lx_type == '1'">
				dept_id in ( select id from ole_base_dept where area_id = #{aeraId})
			</if>
			<if test="lx_type != null and lx_type == '2'">
				dept_id in (#{deptIds})
			</if>
		</where>
	</select>
	
	<select id="getCheckCountByDeptId" resultType="java.lang.String">
		SELECT COUNT(*) FROM ole_ef_check_person
		<where>
			<if test="lx_type != null and lx_type == '1'">
				dept_id in ( select id from ole_base_dept where area_id = #{aeraId})
			</if>
			<if test="lx_type != null and lx_type == '2'">
				dept_id in (#{deptIds})
			</if>
		</where>
	</select>
	<select id="getCaseByCaseNum" resultType="com.orhonit.ole.enforce.dto.api.ApiCaseInfoDTO">
		SELECT 
			ec.id as caseId,
			ec.flow_type as flowType,
			ec.case_name as caseName,
			sd.enum_desc as caseStatus
		FROM ole_ef_case ec 
		LEFT JOIN ole_sys_dict sd ON sd.enum_value = ec.case_status
		AND sd.type_value = '1500'
		<where>
			ec.case_num=#{caseNum}
		</where> 
	</select>
	
	<select id="getPotenceDTO" resultType="com.orhonit.ole.enforce.dto.PotenceDTO">
		SELECT 
			bplm.wz_catalog_name AS wzCatalogName,
			bplm.wz_content AS wzContent,
			bplm.wz_item AS wzItem,
			bplm.fz_catalog_name AS fzCatalogName,
			bplm.fz_content AS fzContent,
			bplm.fz_item AS fzItem
		FROM ole_base_potence_law_map bplm 
		LEFT JOIN ole_ef_case ec ON ec.id=#{caseId}
		WHERE FIND_IN_SET(bplm.id,ec.potence_law_map_id)
	</select>
	
</mapper>
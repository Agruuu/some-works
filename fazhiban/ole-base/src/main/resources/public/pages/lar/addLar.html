<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" media="screen" href="../../css/font-awesome/css/font-awesome.css">
<link rel="stylesheet" href="../../layui/css/layui.css" media="all" />
<link rel="stylesheet" type="text/css" media="screen" href="../../easyui/easyui.css">
</head>
<body>
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
	<form class="form-horizontal" onsubmit="return false" id="form" style="margin-top:20px;">
		<fieldset>
			<div class="form-group">
				<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">父权责</label>
				<div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
				    <input class="easyui-combotree" id="parent_id" type="text"  style="width:100%" name="parent_id"/>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">权责代码<span class="btx">*</span></label>
				<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
					<input class="form-control" placeholder="权责代码" type="text" name="code" id="code"
						data-bv-notempty="true"
						data-bv-notempty-message="权责代码" readonly="readonly">
				</div>
				<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">权责级别<span class="btx">*</span></label>
				<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
				    <select name="level" class="form-control input-sm not-null" iname="权责级别"
						id="level">
						<option value="0">请选择</option>
					</select>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">权责名称<span class="btx">*</span></label>
				<div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
					<input class="form-control not-null" iname="权责名称" placeholder="权责名称" type="text" name="name" id="name"
						data-bv-notempty="true"
						data-bv-notempty-message="权责名称">
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">责任事项<span class="btx">*</span></label>
				<div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
					<textarea class="form-control not-null" rows="5" iname="责任事项" placeholder="责任事项" name="duty" id="duty"></textarea>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">责任依据<span class="btx">*</span></label>
				<div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
					<textarea class="form-control not-null" rows="5" iname="责任依据" placeholder="责任依据" name="duty_ref" id="duty_ref"></textarea>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">审批要件<span class="btx">*</span></label>
				<div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
				    <textarea class="form-control not-null" rows="5" iname="审批要件" placeholder="审批要件" name="approval_req"  id="approval_req"></textarea>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">追责依据<span class="btx">*</span></label>
				<div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
				    <textarea class="form-control not-null" rows="5" iname="追责依据" placeholder="追责依据" name="acc_basis"  id="acc_basis"></textarea>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">办理时限<span class="btx">*</span></label>
				<div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
					<input class="form-control not-null" iname="办理时限" placeholder="办理时限" name="limit_time" id="limit_time" />
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">权责事项类别<span class="btx">*</span></label>
				<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
					<select name="pro_type" class="form-control input-sm not-null" iname="权责事项类别"
						id="pro_type">
						<option value="0">请选择</option>
					</select>
				</div>
				<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">是否生效</label>
				<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
					<select name="is_effect" class="form-control input-sm" id="is_effect">
					</select>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label">备注</label>
				<div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
					<textarea class="form-control" rows="5" placeholder="备注" name="remarks"  id="remarks"></textarea>
				</div>
			</div>
			
			<div class="form-group" style="margin-left:9%;float:left;margin-top:10px;">
				 <button type="button" class="layui-btn" id="test1">
	                <i class="layui-icon">&#xe67c;</i>上传执法流程图
	             </button>
			</div>
            <div id="processIMG" style="float:left;margin-left:40px">
		    </div>
		    <input type="hidden" name="process_id" id="process_id">

			<div class="form-actions" style="margin-bottom:30px;">
				<div class="row" align="center">
					<div class="col-md-12">
						<button class="btn btn-primary" onclick="custom_close()">重置</button>
						<button class="btn btn-primary" type="submit" id="submitBtn" onclick="add()">
							<i class="fa fa-save"></i> 保存
						</button>
					</div>
				</div>
			</div>

		</fieldset>
	</form>
</div>

	<script type="text/javascript" src="../../js/libs/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="../../js/jq.js"></script>
	<script type="text/javascript" src="../../js/plugin/bootstrapvalidator/bootstrapValidator.min.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script type="text/javascript" src="../../js/constans.js"></script>	
	<script type="text/javascript" src="../../js/my/ztree-menu.js"></script>
	<script type="text/javascript" src="../../layui/layui.js"></script>
	<script type="text/javascript" src="../../easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript">
	layui.use(['layer','laydate'], function(){
        var layer = layui.layer;
        var laydate = layui.laydate;
        laydate.render({
           elem: '#act_date'
        });
        laydate.render({
	       elem:'#effect_date'
	    });
    });
		
		getDictList(dict.if_effect,"is_effect");
		getDictList(dict.level,"level");
		getDictList(dict.pro_type,"pro_type");
		
		setCode();
		function setCode(){
			
			$.ajax({
				url:"/base/lartions/getSerialNum",
				type:"GET",
				success:function(data){
					$('#code').val(data);
				}
			});
			/* var timestamp = (new Date()).getTime(); */
		}
		
		function custom_close(){
			$('#name').val("");
			$('#parentId').val("");
			$('#duty').val("");
			$('#is_effect').val("1");
			$('#limit_time').val("");
		}
		
		$("#parent_id").combotree({
			method:'get',		//请求方式	
			url : '/base/LarLists/lars',	//请求的URL
			required: false,
			cascadeCheck:false,
			onLoadSuccess: function (node, data) {
		    }, 
			onChange:function(newV,oldV){
			}
		});
		
		function add() {
			//$('#form').bootstrapValidator();
			//var bootstrapValidator = $("#form").data('bootstrapValidator');
			//bootstrapValidator.validate();
		   // if(!bootstrapValidator.isValid()){
			//   return;
		  //  }
		/* 	if($('#parent_id').val()==null||$('#parent_id').val()==''){
				//alert("父权责为空");
				layer.msg("父权责为空",{anim:6});
				return;
			} */
			if($('#code').val()==null||$('#code').val()==''){
				//alert("权责代码为空");
				layer.msg("权责代码为空",{anim:6});
				return;
			}
			//数据格式校验
			if (!dataCheck()) {
				return;
			}
			
			 $('#submitBtn').removeAttr("disabled");
	         $('#submitBtn').attr("disabled",false); 
		    var formdata = $("#form").serializeObject();

			$.ajax({
				type : 'post',
				url : '/base/lartions',
				contentType: "application/json; charset=utf-8",  
				data : JSON.stringify(formdata),
				success : function(data) {
					layer.msg("添加成功", {shift: -1, time: 1000}, function(){
						 window.parent.location.reload();
						 var index = parent.layer.getFrameIndex(window.name);
						 parent.layer.close(index);
                  });
				}
			});
		}
		
		layui.use(['upload'], function(){
			  var upload = layui.upload;
			  upload.render({
			    elem: '#test1',
			    accept: 'images',
			    url: '/base/lartions/potenceIMG',
			    done: function(res, index, upload){
			    	var url = res.url;
			    	$("#process_id").val(res.processId);
			    	layer.msg("上传成功");
	                var a = "<a target='_blank' href='" + url +"'><img src='" + url + "' width='60px' height='60px'></img></a>";
	                $("#processIMG").html(a);
			    }
			  });
		});
	</script>
</body>
</html>